<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import './block-editor.js';
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [contenteditable="true"]:focus {
            outline: none;
        }
        .block-placeholder:empty:before {
            content: attr(data-placeholder);
            color: #9ca3af;
        }
        .block-item[draggable="true"]:hover {
            cursor: move;
        }
        .block-item.drag-over {
            border-top: 2px solid #3b82f6;
            margin-top: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="blockEditor()" x-init="init()" class="flex h-screen overflow-hidden">
        <!-- Overlay f√ºr Sidebar (schlie√üt Sidebar beim Klick) -->
        <div 
            x-show="showSidebar"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            @click="closeSidebar()"
            class="fixed inset-0 bg-black bg-opacity-20 z-10"
        ></div>

        <!-- Sidebar f√ºr Block-Einstellungen -->
        <div 
            x-show="showSidebar"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="-translate-x-full opacity-0"
            x-transition:enter-end="translate-x-0 opacity-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="translate-x-0 opacity-100"
            x-transition:leave-end="-translate-x-full opacity-0"
            class="w-80 bg-white border-r border-gray-200 shadow-xl overflow-y-auto z-20 fixed left-0 top-0 h-screen"
            @click.stop
        >
            <template x-if="showSidebar">
                <div class="p-4" @click.stop>
                    <div class="flex justify-between items-center mb-4" @click.stop>
                        <h2 class="text-xl font-bold text-gray-900">Block-Einstellungen</h2>
                        <button 
                            @click.stop="closeSidebar()"
                            class="p-1 hover:bg-gray-100 rounded"
                            title="Schlie√üen"
                        >
                            √ó
                        </button>
                    </div>

                    <div x-show="selectedBlockId === null" class="text-center text-gray-500 py-8">
                        <p>Kein Block ausgew√§hlt</p>
                        <p class="text-sm mt-2">W√§hle einen Block aus, um seine Einstellungen zu bearbeiten</p>
                    </div>

                    <template x-for="block in getAllBlocks()" :key="block.id">
                        <div x-show="block.id === selectedBlockId" class="space-y-4">
                            <!-- Block-Typ √§ndern -->
                            <div @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Block-Typ:
                                </label>
                                <select 
                                    x-model="block.type"
                                    @change="changeBlockType(block.id, block.type)"
                                    @click.stop
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                                    <option value="paragraph">üìù Paragraph</option>
                                    <option value="heading1">H1 √úberschrift</option>
                                    <option value="heading2">H2 √úberschrift</option>
                                    <option value="heading3">H3 √úberschrift</option>
                                    <option value="code">üíª Code Block</option>
                                    <option value="quote">üí¨ Zitat</option>
                                    <option value="divider">‚ûñ Trennlinie</option>
                                    <option value="twoColumn">üìä Zwei Spalten</option>
                                    <option value="threeColumn">üìä Drei Spalten</option>
                                    <option value="table">üìã Tabelle</option>
                                </select>
                            </div>

                            <!-- Tailwind CSS Klassen Editor -->
                            <div @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tailwind CSS Klassen:
                                </label>
                                <input 
                                    type="text"
                                    x-model="block.classes"
                                    @input="block.updatedAt = new Date().toISOString()"
                                    @click.stop
                                    @focus.stop
                                    placeholder="z.B. text-red-500 bg-yellow-200 p-4 rounded-lg"
                                    class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                                <div class="mt-2 flex gap-2">
                                    <button 
                                        @click.stop="clearBlockClasses(block.id)"
                                        class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600"
                                    >
                                        Zur√ºcksetzen
                                    </button>
                                </div>
                                <div class="mt-2 text-xs text-gray-500">
                                    Beispiel: <code class="bg-gray-100 px-1 rounded">text-blue-600 bg-gray-100 p-4 rounded-lg shadow-md</code>
                                </div>
                            </div>

                            <!-- CSS Editor (Optional) -->
                            <div @click.stop class="pt-4 border-t border-gray-200">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Inline CSS (Optional):
                                </label>
                                <textarea 
                                    x-model="block.style"
                                    @input="block.updatedAt = new Date().toISOString()"
                                    @click.stop
                                    @focus.stop
                                    placeholder="z.B. color: red; background-color: yellow; padding: 10px;"
                                    class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm h-32 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                ></textarea>
                                <div class="mt-2 flex gap-2">
                                    <button 
                                        @click.stop="clearBlockStyle(block.id)"
                                        class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600"
                                    >
                                        Zur√ºcksetzen
                                    </button>
                                </div>
                                <div class="mt-2 text-xs text-gray-500">
                                    Beispiel: <code class="bg-gray-100 px-1 rounded">color: blue; font-size: 18px; margin: 10px;</code>
                                </div>
                            </div>

                            <!-- Table Management -->
                            <div x-show="block.type === 'table'" class="pt-4 border-t border-gray-200" @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tabellen-Einstellungen:
                                </label>
                                
                                <!-- Header/Footer Toggle -->
                                <div class="mb-4 space-y-2">
                                    <div class="flex items-center gap-2">
                                        <input 
                                            type="checkbox"
                                            :checked="block.tableData?.hasHeader || false"
                                            @change="toggleTableHeader(block.id)"
                                            @click.stop
                                            class="w-4 h-4"
                                        />
                                        <label class="text-sm text-gray-700">Header aktivieren</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input 
                                            type="checkbox"
                                            :checked="block.tableData?.hasFooter || false"
                                            @change="toggleTableFooter(block.id)"
                                            @click.stop
                                            class="w-4 h-4"
                                        />
                                        <label class="text-sm text-gray-700">Footer aktivieren</label>
                                    </div>
                                </div>

                                <!-- Row Management -->
                                <div class="mb-4">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2">Zeilen:</label>
                                    <div class="flex gap-2">
                                        <button 
                                            @click.stop="addTableRow(block.id, 'top')"
                                            class="flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600"
                                        >
                                            + Oben
                                        </button>
                                        <button 
                                            @click.stop="addTableRow(block.id, 'bottom')"
                                            class="flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600"
                                        >
                                            + Unten
                                        </button>
                                    </div>
                                    <div class="mt-2 flex gap-2">
                                        <button 
                                            @click.stop="removeTableRow(block.id, 0)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || block.tableData.cells.length <= 1"
                                        >
                                            - Erste Zeile
                                        </button>
                                        <button 
                                            @click.stop="removeTableRow(block.id, (block.tableData?.cells || []).length - 1)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || block.tableData.cells.length <= 1"
                                        >
                                            - Letzte Zeile
                                        </button>
                                    </div>
                                </div>

                                <!-- Column Management -->
                                <div class="mb-4">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2">Spalten:</label>
                                    <div class="flex gap-2">
                                        <button 
                                            @click.stop="addTableColumn(block.id, 'left')"
                                            class="flex-1 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600"
                                        >
                                            + Links
                                        </button>
                                        <button 
                                            @click.stop="addTableColumn(block.id, 'right')"
                                            class="flex-1 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600"
                                        >
                                            + Rechts
                                        </button>
                                    </div>
                                    <div class="mt-2 flex gap-2">
                                        <button 
                                            @click.stop="removeTableColumn(block.id, 0)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || (block.tableData.cells[0]?.length || 0) <= 1"
                                        >
                                            - Erste Spalte
                                        </button>
                                        <button 
                                            @click.stop="removeTableColumn(block.id, (block.tableData?.cells[0]?.length || 1) - 1)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || (block.tableData.cells[0]?.length || 0) <= 1"
                                        >
                                            - Letzte Spalte
                                        </button>
                                    </div>
                                </div>

                                <!-- Cell Merge Instructions -->
                                <div class="mb-4 p-2 bg-blue-50 rounded text-xs text-gray-600">
                                    <strong>Zellen verbinden:</strong> W√§hle eine Zelle aus und verwende die Kontextmen√º-Optionen oder markiere mehrere Zellen f√ºr das Verbinden.
                                </div>

                                <!-- Table Info -->
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>Zeilen:</strong> <span x-text="(block.tableData?.cells || []).length || 0"></span></div>
                                    <div><strong>Spalten:</strong> <span x-text="(block.tableData?.cells[0]?.length || 0)"></span></div>
                                </div>
                            </div>

                            <!-- Children Management -->
                            <div class="pt-4 border-t border-gray-200" @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Children (Verschachtelte Bl√∂cke):
                                </label>
                                <div class="space-y-2 mb-2">
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div class="flex items-center gap-2 p-2 bg-gray-50 rounded" @click.stop>
                                            <span class="text-xs text-gray-600 flex-1" x-text="child.type + ': ' + (child.content || 'leer')"></span>
                                            <button 
                                                @click.stop="removeChild(block.id, childIndex)"
                                                class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            >
                                                √ó
                                            </button>
                                        </div>
                                    </template>
                                    <div x-show="!block.children || block.children.length === 0" class="text-xs text-gray-400 italic">
                                        Keine Children vorhanden
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select 
                                        x-ref="childTypeSelect"
                                        @click.stop
                                        @change.stop
                                        class="flex-1 p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="paragraph">üìù Paragraph</option>
                                        <option value="heading1">H1 √úberschrift</option>
                                        <option value="heading2">H2 √úberschrift</option>
                                        <option value="heading3">H3 √úberschrift</option>
                                        <option value="code">üíª Code Block</option>
                                        <option value="quote">üí¨ Zitat</option>
                                    </select>
                                    <button 
                                        @click.stop="addChild(block.id, $refs.childTypeSelect.value)"
                                        class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700"
                                    >
                                        + Child
                                    </button>
                                </div>
                            </div>

                            <!-- Block-Info -->
                            <div class="pt-4 border-t border-gray-200" @click.stop>
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>ID:</strong> <span x-text="block.id"></span></div>
                                    <div x-show="block.createdAt"><strong>Erstellt:</strong> <span x-text="new Date(block.createdAt).toLocaleString('de-DE')"></span></div>
                                    <div x-show="block.updatedAt"><strong>Ge√§ndert:</strong> <span x-text="new Date(block.updatedAt).toLocaleString('de-DE')"></span></div>
                                    <div><strong>Children:</strong> <span x-text="(block.children || []).length"></span></div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </template>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto transition-all duration-300" :class="selectedBlockId !== null ? 'ml-80' : ''">
            <div class="max-w-4xl mx-auto py-8 px-4">
                <!-- Header -->
                <div class="mb-8 flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-900">Block Editor</h1>
                    <div class="flex gap-2">
                        <button 
                            @click="openSidebar()"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2"
                            title="Einstellungen √∂ffnen"
                        >
                            ‚öô Einstellungen
                        </button>
                        <button 
                            @click="saveToJSON()" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            Speichern
                        </button>
                        <button 
                            @click="loadFromJSON()" 
                            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                        >
                            Laden
                        </button>
                        <button 
                            @click="exportJSON()" 
                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                        >
                            JSON Export
                        </button>
                        <button 
                            @click="importJSON()" 
                            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                        >
                            JSON Import
                        </button>
                    </div>
                </div>

                <!-- Editor Container -->
                <div class="bg-white rounded-lg shadow-lg p-6 min-h-[600px]">
                    <!-- Toolbar f√ºr neuen Block -->
            <div 
                x-show="showToolbar"
                x-transition
                class="mb-4 p-2 bg-gray-100 rounded-lg flex gap-2 flex-wrap"
            >
                <button 
                    @click="addBlock('paragraph')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    üìù Paragraph
                </button>
                <button 
                    @click="addBlock('heading1')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    H1 √úberschrift
                </button>
                <button 
                    @click="addBlock('heading2')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    H2 √úberschrift
                </button>
                <button 
                    @click="addBlock('heading3')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    H3 √úberschrift
                </button>
                <button 
                    @click="addBlock('code')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    üíª Code Block
                </button>
                <button 
                    @click="addBlock('quote')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    üí¨ Zitat
                </button>
                <button 
                    @click="addBlock('divider')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    ‚ûñ Trennlinie
                </button>
                <button 
                    @click="addBlock('twoColumn')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    üìä Zwei Spalten
                </button>
                <button 
                    @click="addBlock('threeColumn')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    üìä Drei Spalten
                </button>
                <button 
                    @click="addBlock('table')"
                    class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                >
                    üìã Tabelle
                </button>
            </div>

            <!-- Blocks Container -->
            <div class="space-y-2">
                <template x-for="(block, index) in blocks" :key="block.id">
                    <!-- Render Block with Children -->
                    <div>
                        <!-- Main Block -->
                    <div 
                        :class="{
                            'ring-2 ring-blue-500': selectedBlockId === block.id,
                            'opacity-50': draggingBlockId === block.id,
                            'drag-over': dragOverIndex && dragOverIndex.type === 'main' && dragOverIndex.index === index && (!dragStartIndex || dragStartIndex.index !== index)
                        }"
                        class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move"
                        @click.stop="selectBlock(block.id)"
                        @mouseenter="hoveredBlockId = block.id"
                        @mouseleave="hoveredBlockId = null"
                        draggable="true"
                        @dragstart="handleDragStart($event, index)"
                        @dragover.prevent="handleDragOver($event, index)"
                        @drop="handleDrop($event, index)"
                        @dragend="handleDragEnd()"
                        @dragleave="dragOverIndex = null"
                    >
                        <!-- Visual Indicator f√ºr ausgew√§hlten Block -->
                        <div 
                            x-show="selectedBlockId === block.id"
                            class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"
                        ></div>
                        <!-- Block Controls -->
                        <div 
                            x-show="hoveredBlockId === block.id || selectedBlockId === block.id"
                            class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10"
                        >
                            <button 
                                @click.stop="openSidebar(block.id)"
                                class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs"
                                title="Einstellungen √∂ffnen"
                            >
                                ‚öô
                            </button>
                            <button 
                                @click.stop="moveBlock(index, 'up')"
                                :disabled="index === 0"
                                :class="index === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                                class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                title="Nach oben"
                            >
                                ‚Üë
                            </button>
                            <button 
                                @click.stop="moveBlock(index, 'down')"
                                :disabled="index === blocks.length - 1"
                                :class="index === blocks.length - 1 ? 'opacity-50 cursor-not-allowed' : ''"
                                class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                title="Nach unten"
                            >
                                ‚Üì
                            </button>
                            <button 
                                @click.stop="deleteBlock(block.id)"
                                class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600"
                                title="L√∂schen"
                            >
                                √ó
                            </button>
                        </div>

                        <!-- Block Content -->
                        <div class="block-content">
                            <!-- Paragraph -->
                            <div x-show="block.type === 'paragraph'">
                                <div 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder min-h-[1.5rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="Schreibe einen Absatz..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></div>
                            </div>

                            <!-- Heading 1 -->
                            <div x-show="block.type === 'heading1'">
                                <h1 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-3xl font-bold mb-2 min-h-[2rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="√úberschrift 1..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></h1>
                            </div>

                            <!-- Heading 2 -->
                            <div x-show="block.type === 'heading2'">
                                <h2 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="√úberschrift 2..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></h2>
                            </div>

                            <!-- Heading 3 -->
                            <div x-show="block.type === 'heading3'">
                                <h3 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="√úberschrift 3..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></h3>
                            </div>

                            <!-- Code Block -->
                            <div x-show="block.type === 'code'">
                                <pre 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder bg-gray-900 text-green-400 p-4 rounded font-mono text-sm min-h-[4rem] whitespace-pre-wrap', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="Schreibe Code..."
                                    @input="updateBlockContent(block.id, $event.target.textContent)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block, true)"
                                ></pre>
                            </div>

                            <!-- Quote -->
                            <div x-show="block.type === 'quote'">
                                <blockquote 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder border-l-4 border-blue-500 pl-4 italic text-gray-700 min-h-[1.5rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="Zitat..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></blockquote>
                            </div>

                            <!-- Divider -->
                            <div x-show="block.type === 'divider'">
                                <hr class="border-t-2 border-gray-300 my-4">
                            </div>

                            <!-- Two Column -->
                            <div x-show="block.type === 'twoColumn'" class="grid grid-cols-2 gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg min-h-[200px]">
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 1</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 2 === 0" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Spalte 1 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap', child.classes || '']" contenteditable="true" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 0, 2)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 2</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 2 === 1" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder min-h-[1.5rem] text-sm" data-placeholder="Spalte 2 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 1, 2)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                            </div>

                            <!-- Table -->
                            <div x-show="block.type === 'table'" class="overflow-x-auto">
                                <table 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['w-full border-collapse border border-gray-300', block.classes || '']"
                                >
                                    <!-- Header -->
                                    <thead x-show="block.tableData && block.tableData.hasHeader">
                                        <template x-for="(row, rowIndex) in (block.tableData?.cells || []).filter(r => r[0]?.isHeader)" :key="rowIndex">
                                            <tr>
                                                <template x-for="(cell, colIndex) in row" :key="cell.id">
                                                    <th 
                                                        x-show="!cell.merged"
                                                        :colspan="cell.colspan > 1 ? cell.colspan : null"
                                                        :rowspan="cell.rowspan > 1 ? cell.rowspan : null"
                                                        :data-cell-id="cell.id"
                                                        :data-block-id="block.id"
                                                        :data-row-index="rowIndex"
                                                        :data-col-index="colIndex"
                                                        class="border border-gray-300 p-2 bg-gray-100 font-semibold text-left min-w-[100px] min-h-[40px]"
                                                        contenteditable="true"
                                                        @input="updateTableCellContent(block.id, cell.id, $event.target.innerHTML)"
                                                        @focus="selectBlock(block.id); initTableCellContent($event.target, cell)"
                                                    ></th>
                                                </template>
                                            </tr>
                                        </template>
                                    </thead>
                                    
                                    <!-- Body -->
                                    <tbody>
                                        <template x-for="(row, rowIndex) in (block.tableData?.cells || []).filter(r => !r[0]?.isHeader && !r[0]?.isFooter)" :key="rowIndex">
                                            <tr>
                                                <template x-for="(cell, colIndex) in row" :key="cell.id">
                                                    <td 
                                                        x-show="!cell.merged"
                                                        :colspan="cell.colspan > 1 ? cell.colspan : null"
                                                        :rowspan="cell.rowspan > 1 ? cell.rowspan : null"
                                                        :data-cell-id="cell.id"
                                                        :data-block-id="block.id"
                                                        :data-row-index="rowIndex"
                                                        :data-col-index="colIndex"
                                                        class="border border-gray-300 p-2 min-w-[100px] min-h-[40px]"
                                                        contenteditable="true"
                                                        @input="updateTableCellContent(block.id, cell.id, $event.target.innerHTML)"
                                                        @focus="selectBlock(block.id); initTableCellContent($event.target, cell)"
                                                    ></td>
                                                </template>
                                            </tr>
                                        </template>
                                    </tbody>
                                    
                                    <!-- Footer -->
                                    <tfoot x-show="block.tableData && block.tableData.hasFooter">
                                        <template x-for="(row, rowIndex) in (block.tableData?.cells || []).filter(r => r[0]?.isFooter)" :key="rowIndex">
                                            <tr>
                                                <template x-for="(cell, colIndex) in row" :key="cell.id">
                                                    <td 
                                                        x-show="!cell.merged"
                                                        :colspan="cell.colspan > 1 ? cell.colspan : null"
                                                        :rowspan="cell.rowspan > 1 ? cell.rowspan : null"
                                                        :data-cell-id="cell.id"
                                                        :data-block-id="block.id"
                                                        :data-row-index="rowIndex"
                                                        :data-col-index="colIndex"
                                                        class="border border-gray-300 p-2 bg-gray-50 font-semibold min-w-[100px] min-h-[40px]"
                                                        contenteditable="true"
                                                        @input="updateTableCellContent(block.id, cell.id, $event.target.innerHTML)"
                                                        @focus="selectBlock(block.id); initTableCellContent($event.target, cell)"
                                                    ></td>
                                                </template>
                                            </tr>
                                        </template>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- Three Column -->
                            <div x-show="block.type === 'threeColumn'" class="grid grid-cols-3 gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg min-h-[200px]">
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 1</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 3 === 0" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Spalte 1 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap', child.classes || '']" contenteditable="true" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 0, 3)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 2</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 3 === 1" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder min-h-[1.5rem] text-sm" data-placeholder="Spalte 2 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 1, 3)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 3</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 3 === 2" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder min-h-[1.5rem] text-sm" data-placeholder="Spalte 3 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 2, 3)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                            </div>
                        </div>

                        <!-- Children Blocks (Verschachtelt) -->
                        <div x-show="block.children && block.children.length > 0 && block.type !== 'twoColumn' && block.type !== 'threeColumn'" class="ml-8 mt-2 space-y-2 border-l-2 border-gray-300 pl-4">
                            <template x-for="(child, childIndex) in block.children" :key="child.id">
                                <div 
                                    :class="{
                                        'ring-2 ring-blue-500': selectedBlockId === child.id,
                                        'opacity-50': draggingBlockId === child.id,
                                        'drag-over': dragOverIndex && dragOverIndex.type === 'child' && dragOverIndex.parentIndex === index && dragOverIndex.childIndex === childIndex && (!dragStartIndex || dragStartIndex.childIndex !== childIndex)
                                    }"
                                    class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                    @click.stop="selectBlock(child.id)"
                                    @mouseenter="hoveredBlockId = child.id"
                                    @mouseleave="hoveredBlockId = null"
                                    draggable="true"
                                    @dragstart="handleDragStart($event, index, childIndex)"
                                    @dragover.prevent="handleDragOver($event, index, childIndex)"
                                    @drop="handleDrop($event, index, childIndex)"
                                    @dragend="handleDragEnd()"
                                >
                                    <!-- Visual Indicator f√ºr ausgew√§hlten Child Block -->
                                    <div 
                                        x-show="selectedBlockId === child.id"
                                        class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"
                                    ></div>

                                    <!-- Child Block Controls -->
                                    <div 
                                        x-show="hoveredBlockId === child.id || selectedBlockId === child.id"
                                        class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10"
                                    >
                                        <button 
                                            @click.stop="openSidebar(child.id)"
                                            class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs"
                                            title="Einstellungen √∂ffnen"
                                        >
                                            ‚öô
                                        </button>
                                        <button 
                                            @click.stop="moveChildBlock(block.id, childIndex, 'up')"
                                            :disabled="childIndex === 0"
                                            :class="childIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                                            class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                            title="Nach oben"
                                        >
                                            ‚Üë
                                        </button>
                                        <button 
                                            @click.stop="moveChildBlock(block.id, childIndex, 'down')"
                                            :disabled="childIndex === (block.children.length - 1)"
                                            :class="childIndex === (block.children.length - 1) ? 'opacity-50 cursor-not-allowed' : ''"
                                            class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                            title="Nach unten"
                                        >
                                            ‚Üì
                                        </button>
                                        <button 
                                            @click.stop="removeChild(block.id, childIndex)"
                                            class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600"
                                            title="L√∂schen"
                                        >
                                            √ó
                                        </button>
                                    </div>

                                    <!-- Child Block Content -->
                                    <div class="block-content">
                                        <!-- Child Paragraph -->
                                        <div x-show="child.type === 'paragraph'">
                                            <div 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder min-h-[1.5rem] text-sm', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child Absatz..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></div>
                                        </div>

                                        <!-- Child Heading 1 -->
                                        <div x-show="child.type === 'heading1'">
                                            <h1 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child √úberschrift 1..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></h1>
                                        </div>

                                        <!-- Child Heading 2 -->
                                        <div x-show="child.type === 'heading2'">
                                            <h2 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child √úberschrift 2..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></h2>
                                        </div>

                                        <!-- Child Heading 3 -->
                                        <div x-show="child.type === 'heading3'">
                                            <h3 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child √úberschrift 3..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></h3>
                                        </div>

                                        <!-- Child Code Block -->
                                        <div x-show="child.type === 'code'">
                                            <pre 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child Code..."
                                                @input="updateBlockContent(child.id, $event.target.textContent)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child, true)"
                                            ></pre>
                                        </div>

                                        <!-- Child Quote -->
                                        <div x-show="child.type === 'quote'">
                                            <blockquote 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child Zitat..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></blockquote>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Add Block Button -->
                <div 
                    @click="showToolbar = true"
                    class="mt-4 p-4 border-2 border-dashed border-gray-300 rounded-lg text-center text-gray-500 hover:border-blue-500 hover:text-blue-500 cursor-pointer transition-colors"
                >
                    + Block hinzuf√ºgen
                </div>
            </div>
        </div>

        <!-- JSON Display (for debugging) -->
        <div class="mt-8 bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-auto max-h-64">
            <pre x-text="JSON.stringify(blocks, null, 2)"></pre>
        </div>
    </div>

</body>
</html>

