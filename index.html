<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import './block-editor.js';
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.2/dist/cdn.min.js"></script>
    <script>
        // Wiederverwendbare Modal-Helper-Funktionen
        // Initialisiere sofort, nicht erst bei alpine:init
        window.modalHelpers = {
            openModal() {
                if (document.body) {
                    document.body.style.overflow = 'hidden';
                }
            },
            closeModal() {
                if (document.body) {
                    document.body.style.overflow = '';
                }
            }
        };

        // Aktualisiere auch bei alpine:init (falls n√∂tig)
        document.addEventListener('alpine:init', () => {
            if (!window.modalHelpers) {
                window.modalHelpers = {
                    openModal() {
                        if (document.body) {
                            document.body.style.overflow = 'hidden';
                        }
                    },
                    closeModal() {
                        if (document.body) {
                            document.body.style.overflow = '';
                        }
                    }
                };
            }
        });
    </script>
    <style>
        [contenteditable="true"]:focus {
            outline: none;
        }

        .block-placeholder:empty:before {
            content: attr(data-placeholder);
            color: #9ca3af;
        }

        .block-item[draggable="true"]:hover {
            cursor: move;
        }

        .block-item.drag-over {
            border-top: 2px solid #3b82f6;
            margin-top: 4px;
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div x-data="blockEditor()" x-init="init()" class="flex h-screen overflow-hidden">
        <!-- Notification Component -->
        <div x-show="notification.show" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0"
            x-transition:leave-end="opacity-0 translate-y-2" class="fixed top-20 right-4 z-50 max-w-sm w-full"
            @click="hideNotification()">
            <div :class="{
                    'bg-green-50 border-green-200 text-green-800': notification.type === 'success',
                    'bg-red-50 border-red-200 text-red-800': notification.type === 'error',
                    'bg-blue-50 border-blue-200 text-blue-800': notification.type === 'info',
                    'bg-yellow-50 border-yellow-200 text-yellow-800': notification.type === 'warning'
                }"
                class="border rounded-lg shadow-lg p-4 flex items-start gap-3 cursor-pointer hover:shadow-xl transition-shadow">
                <div class="flex-shrink-0">
                    <svg x-show="notification.type === 'success'" class="w-5 h-5 text-green-600" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <svg x-show="notification.type === 'error'" class="w-5 h-5 text-red-600" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <svg x-show="notification.type === 'info'" class="w-5 h-5 text-blue-600" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <svg x-show="notification.type === 'warning'" class="w-5 h-5 text-yellow-600" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                        </path>
                    </svg>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium" x-html="notification.message"></p>
                </div>
                <button @click.stop="hideNotification()"
                    class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
        </div>



        <!-- Overlay f√ºr Sidebar (schlie√üt Sidebar beim Klick) -->
        <div x-show="showSidebar" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0" @click="closeSidebar()"
            class="fixed inset-0 bg-black bg-opacity-20 z-10"></div>

        <!-- Sidebar f√ºr Block-Einstellungen -->
        <div x-show="showSidebar" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="-translate-x-full opacity-0" x-transition:enter-end="translate-x-0 opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="translate-x-0 opacity-100"
            x-transition:leave-end="-translate-x-full opacity-0"
            class="w-80 bg-white border-r border-gray-200 shadow-xl overflow-y-auto z-20 fixed left-0 top-0 h-screen"
            @click.stop>
            <template x-if="showSidebar">
                <div class="p-4" @click.stop>
                    <div class="flex justify-between items-center mb-4" @click.stop>
                        <h2 class="text-xl font-bold text-gray-900">Einstellungen</h2>
                        <button @click.stop="closeSidebar()" class="p-1 hover:bg-gray-100 rounded" title="Schlie√üen">
                            √ó
                        </button>
                    </div>

                    <!-- Tabs f√ºr Sidebar-Navigation -->
                    <div class="flex gap-2 mb-4 border-b border-gray-200" @click.stop>
                        <button @click.stop="sidebarTab = 'blocks'"
                            :class="sidebarTab === 'blocks' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                            class="px-4 py-2 font-semibold transition-colors">
                            Bl√∂cke
                        </button>
                        <button @click.stop="sidebarTab = 'themes'"
                            :class="sidebarTab === 'themes' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                            class="px-4 py-2 font-semibold transition-colors">
                            Themes
                        </button>
                    </div>

                    <!-- Themes Tab -->
                    <div x-show="sidebarTab === 'themes'" class="space-y-4" @click.stop>
                        <div class="flex gap-2">
                            <button @click.stop="openSaveThemeModal()"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 text-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                                Speichern
                            </button>
                            <button @click.stop="openImportThemeModal()"
                                class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 text-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                                    </path>
                                </svg>
                                Import
                            </button>
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">Gespeicherte Themes</h3>
                            <div class="space-y-2 max-h-96 overflow-y-auto">
                                <template x-for="theme in themes" :key="theme.name">
                                    <div
                                        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                        <div class="flex-1 min-w-0">
                                            <div class="font-medium text-gray-900 truncate" x-text="theme.name"></div>
                                            <div class="text-xs text-gray-500"
                                                x-text="new Date(theme.createdAt).toLocaleDateString('de-DE')"></div>
                                        </div>
                                        <div class="flex gap-1 ml-2">
                                            <button @click.stop="showLoadThemeConfirm(theme.name)"
                                                class="p-1.5 bg-green-500 text-white rounded hover:bg-green-600 transition-colors"
                                                title="Theme laden">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12">
                                                    </path>
                                                </svg>
                                            </button>
                                            <button @click.stop="openEditThemeModal(theme.name)"
                                                class="p-1.5 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors"
                                                title="Theme bearbeiten">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                                    </path>
                                                </svg>
                                            </button>
                                            <button @click.stop="showDeleteThemeConfirm(theme.name)"
                                                class="p-1.5 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                                                title="Theme l√∂schen">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                                    </path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </template>
                                <div x-show="themes.length === 0" class="text-center text-gray-500 py-8 text-sm">
                                    <p>Keine Themes gespeichert</p>
                                    <p class="text-xs mt-1">Speichere dein erstes Theme oben</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Blocks Tab -->
                    <div x-show="sidebarTab === 'blocks'">
                        <div x-show="selectedBlockId === null" class="text-center text-gray-500 py-8">
                            <p>Kein Block ausgew√§hlt</p>
                            <p class="text-sm mt-2">W√§hle einen Block aus, um seine Einstellungen zu bearbeiten</p>
                        </div>

                        <template x-for="block in getAllBlocks()" :key="block.id">
                            <div x-show="block.id === selectedBlockId" class="space-y-4">
                                <!-- Block-Typ √§ndern -->
                                <div @click.stop>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Block-Typ:
                                    </label>
                                    <select x-model="block.type" @change="changeBlockType(block.id, block.type)"
                                        @click.stop
                                        class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <template x-for="(config, blockType) in childBlockTypes" :key="blockType">
                                            <option :value="blockType">
                                                <span x-text="config.icon ? config.icon + ' ' : ''"></span>
                                                <span x-text="config.label || blockType"></span>
                                            </option>
                                        </template>
                                    </select>
                                </div>

                                <!-- Tailwind CSS Klassen Editor -->
                                <div @click.stop>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Tailwind CSS Klassen:
                                    </label>
                                    <input type="text" x-model="block.classes"
                                        @input="block.updatedAt = new Date().toISOString()" @click.stop @focus.stop
                                        placeholder="z.B. text-red-500 bg-yellow-200 p-4 rounded-lg"
                                        class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                    <div class="mt-2 flex gap-2"
                                        x-show="block.classes && block.classes.trim().length > 0">
                                        <button @click.stop="clearBlockClasses(block.id)"
                                            class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                                            Zur√ºcksetzen
                                        </button>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        Beispiel: <code
                                            class="bg-gray-100 px-1 rounded">text-blue-600 bg-gray-100 p-4 rounded-lg shadow-md</code>
                                    </div>
                                </div>

                                <!-- HTML ID Editor -->
                                <div @click.stop class="pt-4 border-t border-gray-200">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        HTML ID (Optional):
                                    </label>
                                    <input type="text" x-model="block.htmlId"
                                        @input="block.updatedAt = new Date().toISOString()" @click.stop @focus.stop
                                        placeholder="z.B. my-custom-id"
                                        class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                    <div class="mt-2 flex gap-2"
                                        x-show="block.htmlId && block.htmlId.trim().length > 0">
                                        <button @click.stop="clearBlockHtmlId(block.id)"
                                            class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                                            Zur√ºcksetzen
                                        </button>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        Beispiel: <code class="bg-gray-100 px-1 rounded">my-section-header</code>
                                    </div>
                                </div>

                                <!-- CSS Editor (Optional) -->
                                <div @click.stop class="pt-4 border-t border-gray-200">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        Inline CSS (Optional):
                                    </label>
                                    <textarea x-model="block.style" @input="block.updatedAt = new Date().toISOString()"
                                        @click.stop @focus.stop
                                        placeholder="z.B. color: red; background-color: yellow; padding: 10px;"
                                        class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm h-32 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                                    <div class="mt-2 flex gap-2" x-show="block.style && block.style.trim().length > 0">
                                        <button @click.stop="clearBlockStyle(block.id)"
                                            class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                                            Zur√ºcksetzen
                                        </button>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        Beispiel: <code
                                            class="bg-gray-100 px-1 rounded">color: blue; font-size: 18px; margin: 10px;</code>
                                    </div>
                                </div>

                                <!-- Block-spezifische Einstellungen aus Komponente -->
                                <div x-html="renderBlockSettings(block)"
                                    x-effect="updateBlockSettingsReactive(block, $el)"></div>

                                <!-- Cell Merge Instructions -->
                                <div class="mb-4 p-2 bg-blue-50 rounded text-xs text-gray-600">
                                    <strong>Zellen verbinden:</strong> W√§hle eine Zelle aus und verwende die
                                    Kontextmen√º-Optionen oder markiere mehrere Zellen f√ºr das Verbinden.
                                </div>

                                <!-- Table Info -->
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>Zeilen:</strong> <span
                                            x-text="(block.tableData?.cells || []).length || 0"></span></div>
                                    <div><strong>Spalten:</strong> <span
                                            x-text="(block.tableData?.cells[0]?.length || 0)"></span></div>
                                </div>
                            </div>

                            <!-- Checklist Management -->
                            <div x-show="block.type === 'checklist'" class="pt-4 border-t border-gray-200" @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Checkliste-Einstellungen:
                                </label>

                                <!-- Item Management -->
                                <div class="mb-4">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2">Eintr√§ge:</label>
                                    <div class="flex gap-2">
                                        <button @click.stop="addChecklistItem(block.id, 'top')"
                                            class="flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600">
                                            + Oben
                                        </button>
                                        <button @click.stop="addChecklistItem(block.id, 'bottom')"
                                            class="flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600">
                                            + Unten
                                        </button>
                                    </div>
                                </div>

                                <!-- Checklist Info -->
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>Eintr√§ge:</strong> <span
                                            x-text="(block.checklistData?.items || []).length || 0"></span></div>
                                </div>
                            </div>

                            <!-- Children Management -->
                            <div class="pt-4 border-t border-gray-200" @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Children (Verschachtelte Bl√∂cke):
                                </label>
                                <div class="space-y-2 mb-2">
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div class="flex items-center gap-2 p-2 bg-gray-50 rounded" @click.stop>
                                            <span class="text-xs text-gray-600 flex-1"
                                                x-text="child.type + ': ' + (child.content || 'leer')"></span>
                                            <button @click.stop="removeChild(block.id, childIndex)"
                                                class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">
                                                √ó
                                            </button>
                                        </div>
                                    </template>
                                    <div x-show="!block.children || block.children.length === 0"
                                        class="text-xs text-gray-400 italic">
                                        Keine Children vorhanden
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select x-ref="childTypeSelect" @click.stop @change.stop
                                        class="flex-1 p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500">
                                        <option value="" disabled selected>Block-Typ w√§hlen...</option>
                                        <template x-for="(type, key) in childBlockTypes" :key="key">
                                            <option :value="key" x-text="type.label"></option>
                                        </template>
                                    </select>
                                    <button @click.stop="addChild(block.id, $refs.childTypeSelect.value)"
                                        class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">
                                        + Child
                                    </button>
                                </div>
                            </div>

                            <!-- Block-Info -->
                            <div class="pt-4 border-t border-gray-200" @click.stop>
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>ID:</strong> <span x-text="block.id"></span></div>
                                    <div x-show="block.createdAt"><strong>Erstellt:</strong> <span
                                            x-text="new Date(block.createdAt).toLocaleString('de-DE')"></span></div>
                                    <div x-show="block.updatedAt"><strong>Ge√§ndert:</strong> <span
                                            x-text="new Date(block.updatedAt).toLocaleString('de-DE')"></span></div>
                                    <div><strong>Children:</strong> <span x-text="(block.children || []).length"></span>
                                    </div>
                                </div>
                            </div>
                    </div>
            </template>
        </div>
    </div>
    </template>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-y-auto transition-all duration-300">
        <div class="max-w-4xl mx-auto py-8 px-4">
            <!-- Header -->
            <div class="mb-8 flex justify-between items-center">
                <h1 class="text-3xl font-bold text-gray-900">Block Editor</h1>
                <div class="flex gap-2">
                    <button @click="openSidebar()"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2"
                        title="Einstellungen √∂ffnen">
                        ‚öô Einstellungen
                    </button>
                    <button @click="saveToJSON()"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Speichern
                    </button>
                    <button @click="exportJSON()"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        JSON Export
                    </button>
                    <button @click="importJSON()"
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                        JSON Import
                    </button>
                </div>
            </div>

            <!-- Editor Container -->
            <div class="bg-white rounded-lg shadow-lg p-6 min-h-[600px]">
                <!-- Toolbar f√ºr neuen Block -->
                <div x-cloak x-show="showToolbar" @click.outside="showToolbar = false" x-transition
                    class="mb-4 p-2 bg-gray-100 rounded-lg">
                    <!-- Block-Typen - Automatisch aus BLOCK_TYPES generiert -->
                    <div class="flex gap-2 flex-wrap mb-3">
                        <template x-for="(config, blockType) in childBlockTypes" :key="blockType">
                            <button @click="addBlock(blockType)"
                                class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm">
                                <span x-text="config.label || blockType"></span>
                            </button>
                        </template>
                    </div>

                    <!-- Theme-Vorlagen -->
                    <div class="border-t border-gray-300 pt-3">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-semibold text-gray-600">üé® Theme-Vorlagen:</span>
                            <button @click.stop="showThemeDropdown = !showThemeDropdown"
                                class="text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1">
                                <span x-text="showThemeDropdown ? 'Ausblenden' : 'Anzeigen'"></span>
                                <svg class="w-4 h-4 transition-transform" :class="showThemeDropdown ? 'rotate-180' : ''"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div x-show="showThemeDropdown" x-transition:enter="transition ease-out duration-200"
                            x-transition:enter-start="opacity-0 max-h-0" x-transition:enter-end="opacity-100 max-h-96"
                            x-transition:leave="transition ease-in duration-150"
                            x-transition:leave-start="opacity-100 max-h-96" x-transition:leave-end="opacity-0 max-h-0"
                            class="overflow-hidden">
                            <div class="space-y-1 max-h-64 overflow-y-auto">
                                <template x-for="theme in themes" :key="theme.name">
                                    <button @click.stop="loadThemeFromToolbar(theme.name)"
                                        class="w-full px-3 py-2 bg-white rounded hover:bg-blue-50 text-left text-sm flex items-center justify-between group transition-colors">
                                        <div class="flex-1 min-w-0">
                                            <div class="font-medium text-gray-900 truncate" x-text="theme.name"></div>
                                            <div class="text-xs text-gray-500"
                                                x-text="(theme.data || []).length + ' Bl√∂cke'"></div>
                                        </div>
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-600 transition-colors"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12">
                                            </path>
                                        </svg>
                                    </button>
                                </template>
                                <div x-show="themes.length === 0" class="px-3 py-2 text-xs text-gray-500 text-center">
                                    Keine Themes verf√ºgbar
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blocks Container -->
                <div class="space-y-2">
                    <template x-for="(block, index) in blocks" :key="block.id">
                        <!-- Render Block with Children -->
                        <div>
                            <!-- Main Block -->
                            <div :class="{
                            'ring-2 ring-blue-500': selectedBlockId === block.id,
                            'opacity-50': draggingBlockId === block.id,
                            'drag-over': dragOverIndex && dragOverIndex.type === 'main' && dragOverIndex.index === index && (!dragStartIndex || dragStartIndex.index !== index)
                        }" class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move"
                                @click.stop="selectBlock(block.id)" @mouseenter="hoveredBlockId = block.id"
                                @mouseleave="hoveredBlockId = null" draggable="true"
                                @dragstart="handleDragStart($event, index)"
                                @dragover.prevent="handleDragOver($event, index)" @drop="handleDrop($event, index)"
                                @dragend="handleDragEnd()" @dragleave="dragOverIndex = null">
                                <!-- Visual Indicator f√ºr ausgew√§hlten Block -->
                                <div x-show="selectedBlockId === block.id"
                                    class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                <!-- Block Controls -->
                                <div x-show="hoveredBlockId === block.id || selectedBlockId === block.id"
                                    class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                    <button @click.stop="openSidebar(block.id)"
                                        class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs"
                                        title="Einstellungen √∂ffnen">
                                        ‚öô
                                    </button>
                                    <button @click.stop="moveBlock(index, 'up')" :disabled="index === 0"
                                        :class="index === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                                        class="p-1 bg-white rounded shadow hover:bg-gray-100" title="Nach oben">
                                        ‚Üë
                                    </button>
                                    <button @click.stop="moveBlock(index, 'down')"
                                        :disabled="index === blocks.length - 1"
                                        :class="index === blocks.length - 1 ? 'opacity-50 cursor-not-allowed' : ''"
                                        class="p-1 bg-white rounded shadow hover:bg-gray-100" title="Nach unten">
                                        ‚Üì
                                    </button>
                                    <button @click.stop="deleteBlock(block.id)"
                                        class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600"
                                        title="L√∂schen">
                                        √ó
                                    </button>
                                </div>

                                <!-- Block Content -->
                                <div class="block-content">
                                    <!-- Zentrale Rendering-Funktion f√ºr alle Block-Typen -->
                                    <div x-html="renderBlock(block)"></div>

                                </div>
                            </div>

                            <!-- Children Blocks (Verschachtelt) - f√ºr normale Container -->
                            <div x-show="block.children && block.children.length > 0 && block.type !== 'twoColumn' && block.type !== 'threeColumn' && block.type !== 'link'"
                                class="ml-8 mt-2 space-y-2 border-l-2 border-gray-300 pl-4">
                                <template x-for="(child, childIndex) in block.children" :key="child.id">
                                    <div :class="{
                                        'ring-2 ring-blue-500': selectedBlockId === child.id,
                                        'opacity-50': draggingBlockId === child.id,
                                        'drag-over': dragOverIndex && dragOverIndex.type === 'child' && dragOverIndex.parentIndex === index && dragOverIndex.childIndex === childIndex && (!dragStartIndex || dragStartIndex.childIndex !== childIndex)
                                    }" class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                        @click.stop="selectBlock(child.id)" @mouseenter="hoveredBlockId = child.id"
                                        @mouseleave="hoveredBlockId = null" draggable="true"
                                        @dragstart="handleDragStart($event, index, childIndex)"
                                        @dragover.prevent="handleDragOver($event, index, childIndex)"
                                        @drop="handleDrop($event, index, childIndex)" @dragend="handleDragEnd()">
                                        <!-- Visual Indicator f√ºr ausgew√§hlten Child Block -->
                                        <div x-show="selectedBlockId === child.id"
                                            class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>

                                        <!-- Child Block Controls -->
                                        <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id"
                                            class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                            <button @click.stop="openSidebar(child.id)"
                                                class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs"
                                                title="Einstellungen √∂ffnen">
                                                ‚öô
                                            </button>
                                            <button @click.stop="moveChildBlock(block.id, childIndex, 'up')"
                                                :disabled="childIndex === 0"
                                                :class="childIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                                                class="p-1 bg-white rounded shadow hover:bg-gray-100" title="Nach oben">
                                                ‚Üë
                                            </button>
                                            <button @click.stop="moveChildBlock(block.id, childIndex, 'down')"
                                                :disabled="childIndex === (block.children.length - 1)"
                                                :class="childIndex === (block.children.length - 1) ? 'opacity-50 cursor-not-allowed' : ''"
                                                class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                                title="Nach unten">
                                                ‚Üì
                                            </button>
                                            <button @click.stop="removeChild(block.id, childIndex)"
                                                class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600"
                                                title="L√∂schen">
                                                √ó
                                            </button>
                                        </div>

                                        <!-- Child Block Content -->
                                        <div class="block-content">
                                            <!-- Zentrale Rendering-Funktion f√ºr alle Child-Block-Typen -->
                                            <div x-html="renderChild(child, block, childIndex)"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <!-- Add Block Button -->
                    <div @click="showToolbar = true; showThemeDropdown = false"
                        class="mt-4 p-4 border-2 border-dashed border-gray-300 rounded-lg text-center text-gray-500 hover:border-blue-500 hover:text-blue-500 cursor-pointer transition-colors">
                        + Block hinzuf√ºgen
                    </div>
                </div>
            </div>

            <!-- JSON Display (for debugging) -->
            <div
                class="mt-8 bg-gray-900 text-green-400 p-4 pr-0 rounded-lg overflow-auto font-mono text-xs max-h-64 relative">
                <!-- Copy JSON to Clipboard Button -->
                <button @click="copyJSONToClipboard()"
                    class="absolute top-4 right-4 z-[10] p-3  text-slate-400  hover:text-green-400 transition-colors hover:shadow-xl"
                    title="Editor JSON in Zwischenablage kopieren">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                        </path>
                    </svg>
                </button>
                <div class="overflow-auto ">
                    <pre x-text="JSON.stringify(blocks, null, 2)"></pre>
                </div>

            </div>
        </div>

        <!-- JSON Import Modal -->
        <div x-show="showImportModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeImportModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900">JSON Import</h2>
                    <button @click="closeImportModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 overflow-hidden flex flex-col p-6">
                    <!-- JSON Input Area -->
                    <div class="flex-1 flex flex-col mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            JSON eingeben oder einf√ºgen:
                        </label>
                        <textarea x-model="importJSONText" @input="validateImportJSON()"
                            class="flex-1 w-full p-4 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
                            placeholder='[{"id": "block-1-1234567890", "type": "paragraph", "content": "Beispiel..."}]'
                            spellcheck="false"></textarea>
                    </div>

                    <!-- Validation Status -->
                    <div class="mb-4">
                        <div x-show="importJSONError" class="p-3 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-start gap-2">
                                <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="flex-1">
                                    <p class="text-sm font-semibold text-red-800 mb-1">JSON Fehler:</p>
                                    <p class="text-sm text-red-700" x-text="importJSONError"></p>
                                </div>
                            </div>
                        </div>
                        <div x-show="!importJSONError && importJSONText && importJSONValid"
                            class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center gap-2">
                                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7"></path>
                                </svg>
                                <p class="text-sm font-semibold text-green-800">JSON ist g√ºltig!</p>
                            </div>
                        </div>
                        <div x-show="!importJSONText" class="p-3 bg-gray-50 border border-gray-200 rounded-lg">
                            <p class="text-sm text-gray-600">Geben Sie JSON-Daten ein, um sie zu importieren.</p>
                        </div>
                    </div>

                    <!-- Preview Info -->
                    <div x-show="importJSONValid && importJSONPreview"
                        class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm font-semibold text-blue-800 mb-1">Vorschau:</p>
                        <p class="text-sm text-blue-700">
                            <span x-text="importJSONPreview?.blockCount || 0"></span> Block(s) werden importiert
                        </p>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button @click="closeImportModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Abbrechen
                    </button>
                    <button @click="confirmImportJSON()" :disabled="!importJSONValid || !importJSONText"
                        :class="(!importJSONValid || !importJSONText) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-purple-700'"
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg transition-colors">
                        Importieren
                    </button>
                </div>
            </div>
        </div>

        <!-- Save Theme Modal -->
        <div x-show="showSaveThemeModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeSaveThemeModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900">Theme speichern</h2>
                    <button @click="closeSaveThemeModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Theme-Name:
                        </label>
                        <input type="text" x-model="newThemeName" @keydown.enter="saveTheme()"
                            @keydown.escape="closeSaveThemeModal()" placeholder="z.B. Mein Theme"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            autofocus />
                        <div x-show="saveThemeError"
                            class="mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700">
                            <span x-text="saveThemeError"></span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-4">
                        <p>Das aktuelle Layout wird als Theme gespeichert.</p>
                        <p class="mt-1"><strong>Bl√∂cke:</strong> <span x-text="blocks.length"></span></p>
                        <p class="mt-1 text-xs text-gray-500">Die Datei wird im themes Ordner gespeichert.</p>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button @click="closeSaveThemeModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Abbrechen
                    </button>
                    <button @click="saveTheme()" :disabled="!newThemeName || !newThemeName.trim()"
                        :class="(!newThemeName || !newThemeName.trim()) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg transition-colors">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Theme Modal -->
        <div x-show="showEditThemeModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeEditThemeModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900">Theme bearbeiten</h2>
                    <button @click="closeEditThemeModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Theme-Name:
                        </label>
                        <input type="text" x-model="editThemeName" @keydown.enter="updateTheme()"
                            @keydown.escape="closeEditThemeModal()" placeholder="Theme-Name"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            autofocus />
                        <div x-show="editThemeError"
                            class="mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700">
                            <span x-text="editThemeError"></span>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 mb-4">
                        <p>√Ñndere den Namen des Themes. Die Datei wird beim n√§chsten Speichern aktualisiert.</p>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button @click="closeEditThemeModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Abbrechen
                    </button>
                    <button @click="updateTheme()" :disabled="!editThemeName || !editThemeName.trim()"
                        :class="(!editThemeName || !editThemeName.trim()) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-yellow-700'"
                        class="px-4 py-2 bg-yellow-600 text-white rounded-lg transition-colors">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

        <!-- Import Theme Modal -->
        <div x-show="showImportThemeModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeImportThemeModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900">Theme importieren</h2>
                    <button @click="closeImportThemeModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            JSON-Datei ausw√§hlen:
                        </label>
                        <input type="file" accept=".json" @change="handleThemeFileImport($event)"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" />
                    </div>
                    <div class="text-sm text-gray-600 mb-4">
                        <p>W√§hle eine JSON-Datei aus dem themes Ordner aus, um ein Theme zu importieren.</p>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button @click="closeImportThemeModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Schlie√üen
                    </button>
                </div>
            </div>
        </div>

        <!-- JSON Export Modal -->
        <div x-show="showExportModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeExportModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900">JSON Export</h2>
                    <button @click="closeExportModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 overflow-hidden flex flex-col p-6">
                    <!-- JSON Display Area -->
                    <div class="flex-1 flex flex-col mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                Aktuelles Editor JSON:
                            </label>
                            <div class="text-sm text-gray-500">
                                <span x-text="blocks.length"></span> Block(s)
                            </div>
                        </div>
                        <textarea x-ref="exportJSONTextarea" x-model="exportJSONText" readonly
                            class="flex-1 w-full p-4 border border-gray-300 rounded-lg font-mono text-sm bg-gray-50 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            spellcheck="false"></textarea>
                    </div>

                    <!-- Info -->
                    <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-sm text-blue-800">
                            <strong>Tipp:</strong> Sie k√∂nnen den JSON-Code kopieren oder als Datei herunterladen.
                        </p>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button @click="copyExportJSON()"
                        :class="exportCopied ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'"
                        class="px-4 py-2 text-white rounded-lg transition-colors flex items-center gap-2">
                        <svg x-show="!exportCopied" class="w-5 h-5" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                            </path>
                        </svg>
                        <svg x-show="exportCopied" class="w-5 h-5" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        <span x-text="exportCopied ? 'Kopiert!' : 'Kopieren'"></span>
                    </button>
                    <button @click="downloadExportJSON()"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Herunterladen
                    </button>
                    <button @click="closeExportModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Schlie√üen
                    </button>
                </div>
            </div>
        </div>

        <!-- Floating Toolbar f√ºr Text-Selektion -->
        <div x-show="showFloatingToolbar" x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-150" x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
            class="bn-toolbar bn-formatting-toolbar bg-white text-gray-900 flex h-fit gap-1 rounded-lg border border-gray-200 p-1 shadow-md fixed z-50"
            :style="'top: ' + floatingToolbarPosition.top + 'px; left: ' + floatingToolbarPosition.left + 'px; transform: translateX(-50%);'"
            @click.stop style="display: none;">
            <!-- Bold -->
            <button type="button" @click.stop="applyTextFormat('bold')" x-bind:data-state="getFormatState('bold')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Bold" data-test="bold">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M8 11H12.5C13.8807 11 15 9.88071 15 8.5C15 7.11929 13.8807 6 12.5 6H8V11ZM18 15.5C18 17.9853 15.9853 20 13.5 20H6V4H12.5C14.9853 4 17 6.01472 17 8.5C17 9.70431 16.5269 10.7981 15.7564 11.6058C17.0979 12.3847 18 13.837 18 15.5ZM8 13V18H13.5C14.8807 18 16 16.8807 16 15.5C16 14.1193 14.8807 13 13.5 13H8Z">
                    </path>
                </svg>
            </button>

            <!-- Italic -->
            <button type="button" @click.stop="applyTextFormat('italic')" x-bind:data-state="getFormatState('italic')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Italic" data-test="italic">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 20H7V18H9.92661L12.0425 6H9V4H17V6H14.0734L11.9575 18H15V20Z"></path>
                </svg>
            </button>

            <!-- Underline -->
            <button type="button" @click.stop="applyTextFormat('underline')"
                x-bind:data-state="getFormatState('underline')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Underline" data-test="underline">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M8 3V12C8 14.2091 9.79086 16 12 16C14.2091 16 16 14.2091 16 12V3H18V12C18 15.3137 15.3137 18 12 18C8.68629 18 6 15.3137 6 12V3H8ZM4 20H20V22H4V20Z">
                    </path>
                </svg>
            </button>

            <!-- Strike -->
            <button type="button" @click.stop="applyTextFormat('strikeThrough')"
                x-bind:data-state="getFormatState('strikeThrough')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Strike" data-test="strike">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17.1538 14C17.3846 14.5161 17.5 15.0893 17.5 15.7196C17.5 17.0625 16.9762 18.1116 15.9286 18.867C14.8809 19.6223 13.4335 20 11.5862 20C9.94674 20 8.32335 19.6185 6.71592 18.8555V16.6009C8.23538 17.4783 9.7908 17.917 11.3822 17.917C13.9333 17.917 15.2128 17.1846 15.2208 15.7196C15.2208 15.0939 15.0049 14.5598 14.5731 14.1173C14.5339 14.0772 14.4939 14.0381 14.4531 14H3V12H21V14H17.1538ZM13.076 11H7.62908C7.4566 10.8433 7.29616 10.6692 7.14776 10.4778C6.71592 9.92084 6.5 9.24559 6.5 8.45207C6.5 7.21602 6.96583 6.165 7.89749 5.299C8.82916 4.43299 10.2706 4 12.2219 4C13.6934 4 15.1009 4.32808 16.4444 4.98426V7.13591C15.2448 6.44921 13.9293 6.10587 12.4978 6.10587C10.0187 6.10587 8.77917 6.88793 8.77917 8.45207C8.77917 8.87172 8.99709 9.23796 9.43293 9.55079C9.86878 9.86362 10.4066 10.1135 11.0463 10.3004C11.6665 10.4816 12.3431 10.7148 13.076 11H13.076Z">
                    </path>
                </svg>
            </button>

            <!-- Text Alignment: Left -->
            <button type="button" @click.stop="applyTextAlignmentToSelection('left')"
                x-bind:data-state="getTextAlignmentState('left')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Align text left" data-test="alignTextLeft">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4H21V6H3V4ZM3 19H17V21H3V19ZM3 14H21V16H3V14ZM3 9H17V11H3V9Z"></path>
                </svg>
            </button>

            <!-- Text Alignment: Center -->
            <button type="button" @click.stop="applyTextAlignmentToSelection('center')"
                x-bind:data-state="getTextAlignmentState('center')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Align text center" data-test="alignTextCenter">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4H21V6H3V4ZM5 19H19V21H5V19ZM3 14H21V16H3V14ZM5 9H19V11H5V9Z"></path>
                </svg>
            </button>

            <!-- Text Alignment: Right -->
            <button type="button" @click.stop="applyTextAlignmentToSelection('right')"
                x-bind:data-state="getTextAlignmentState('right')"
                class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-gray-100 hover:text-gray-900 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-blue-100 data-[state=on]:text-blue-900 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] whitespace-nowrap bg-transparent h-9 px-2 min-w-9 bn-button"
                aria-label="Align text right" data-test="alignTextRight">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4H21V6H3V4ZM7 19H21V21H7V19ZM3 14H21V16H3V14ZM7 9H21V11H7V9Z"></path>
                </svg>
            </button>

            <!-- Colors Dropdown -->
            <div class="relative" x-data="{ showColorPicker: false }">
                <button type="button" @click.stop="showColorPicker = !showColorPicker"
                    class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 outline-none focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] hover:bg-gray-100 hover:text-gray-900 h-9 px-4 py-2 has-[>svg]:px-3 bn-button"
                    aria-label="Colors" data-test="colors">
                    <div class="bn-color-icon" data-background-color="default" data-text-color="default"
                        style="pointer-events: none; font-size: 15px; height: 20px; line-height: 20px; text-align: center; width: 20px;">
                        A</div>
                </button>

                <!-- Color Picker Dropdown -->
                <div x-show="showColorPicker" @click.away="showColorPicker = false" x-transition
                    class="absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-2 z-50 min-w-[200px]">
                    <div class="text-xs font-semibold text-gray-700 mb-2 px-2">Textfarbe</div>
                    <div class="grid grid-cols-8 gap-1 mb-3">
                        <template
                            x-for="color in ['#000000', '#FFFFFF', '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#808080', '#800000', '#008000', '#000080', '#808000', '#800080', '#008080', '#C0C0C0']">
                            <button @click.stop="applyTextColor(color); showColorPicker = false"
                                class="w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform"
                                x-bind:style="'background-color: ' + color" x-bind:title="color"></button>
                        </template>
                    </div>
                    <div class="text-xs font-semibold text-gray-700 mb-2 px-2">Hintergrundfarbe</div>
                    <div class="grid grid-cols-8 gap-1">
                        <template
                            x-for="color in ['#FFFFFF', '#000000', '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#808080', '#800000', '#008000', '#000080', '#808000', '#800080', '#008080', '#C0C0C0']">
                            <button @click.stop="applyBackgroundColor(color); showColorPicker = false"
                                class="w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform"
                                x-bind:style="'background-color: ' + color" x-bind:title="color"></button>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Link -->
            <button type="button" @click.stop="openLinkInputForSelection()"
                class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg]:w-4 [&_svg]:h-4 outline-none focus-visible:border-blue-500 focus-visible:ring-blue-500/50 focus-visible:ring-[3px] hover:bg-gray-100 hover:text-gray-900 h-9 px-4 py-2 has-[>svg]:px-3 bn-button"
                aria-label="Create link" data-test="createLink">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em"
                    width="1em" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M18.3638 15.5355L16.9496 14.1213L18.3638 12.7071C20.3164 10.7545 20.3164 7.58866 18.3638 5.63604C16.4112 3.68341 13.2453 3.68341 11.2927 5.63604L9.87849 7.05025L8.46428 5.63604L9.87849 4.22182C12.6122 1.48815 17.0443 1.48815 19.778 4.22182C22.5117 6.95549 22.5117 11.3876 19.778 14.1213L18.3638 15.5355ZM15.5353 18.364L14.1211 19.7782C11.3875 22.5118 6.95531 22.5118 4.22164 19.7782C1.48797 17.0445 1.48797 12.6123 4.22164 9.87868L5.63585 8.46446L7.05007 9.87868L5.63585 11.2929C3.68323 13.2455 3.68323 16.4113 5.63585 18.364C7.58847 20.3166 10.7543 20.3166 12.7069 18.364L14.1211 16.9497L15.5353 18.364ZM14.8282 7.75736L16.2425 9.17157L9.17139 16.2426L7.75717 14.8284L14.8282 7.75736Z">
                    </path>
                </svg>
            </button>
        </div>

        <!-- Einheitliches Link-Modal -->
        <div x-show="showLinkModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeLinkModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full flex flex-col" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-900"
                        x-text="linkModal.type === 'edit' ? 'üîó Link bearbeiten' : linkModal.type === 'block' ? 'üîó Link-Einstellungen' : 'üîó Link hinzuf√ºgen'">
                    </h2>
                    <button @click="closeLinkModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 overflow-y-auto p-6">
                    <div class="space-y-6">
                        <!-- Text-Anzeige (nur f√ºr selection und edit) -->
                        <div x-show="linkModal.type === 'selection' || linkModal.type === 'edit'">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Text:
                            </label>
                            <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-700 border border-gray-200"
                                x-text="linkModal.text || selectedText || ''"></div>
                        </div>

                        <!-- URL Eingabe -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                URL:
                            </label>
                            <input type="url" x-model="linkModal.url" @keydown.enter.prevent="saveLink()" @click.stop
                                @focus.stop placeholder="https://example.com"
                                class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <p class="mt-1 text-xs text-gray-500">
                                Die URL, zu der der Link f√ºhren soll
                            </p>
                        </div>

                        <!-- Link-Text Eingabe (nur f√ºr block) -->
                        <div x-show="linkModal.type === 'block'">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Link-Text <span class="text-gray-400 font-normal text-xs">(optional)</span>:
                            </label>
                            <input type="text" x-model="linkModal.linkText" @keydown.enter.prevent="saveLink()"
                                @click.stop @focus.stop placeholder="Z.B. 'Mehr erfahren' oder leer lassen"
                                class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                            <p class="mt-1 text-xs text-gray-500">
                                Optionaler Text, der f√ºr den Link angezeigt wird. Wenn leer, wird die URL verwendet.
                            </p>
                        </div>

                        <!-- Target Auswahl (f√ºr block, edit und selection) -->
                        <div
                            x-show="linkModal.type === 'block' || linkModal.type === 'edit' || linkModal.type === 'selection'">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Link √∂ffnen in:
                            </label>
                            <select x-model="linkModal.target" @click.stop @focus.stop
                                class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="_self">Gleichem Tab/Fenster</option>
                                <option value="_blank">Neuem Tab/Fenster</option>
                                <option value="_parent">√úbergeordnetem Frame</option>
                                <option value="_top">Vollst√§ndigem Fenster</option>
                            </select>
                            <p class="mt-1 text-xs text-gray-500">
                                Legt fest, wo der Link ge√∂ffnet werden soll
                            </p>
                        </div>

                        <!-- Vorschau (nur f√ºr block) -->
                        <div x-show="linkModal.type === 'block'" class="pt-4 border-t border-gray-200">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Vorschau:
                            </label>
                            <div
                                class="border border-gray-300 rounded-lg p-4 bg-gray-50 min-h-[60px] flex items-center">
                                <a x-show="linkModal.url && linkModal.url.trim() !== ''" :href="linkModal.url"
                                    :target="linkModal.target || '_self'"
                                    class="text-blue-600 hover:text-blue-800 hover:underline" @click.stop>
                                    <span
                                        x-text="(linkModal.linkText && linkModal.linkText.trim() !== '') ? linkModal.linkText : (linkModal.url || 'Keine URL eingegeben')"></span>
                                </a>
                                <span x-show="!linkModal.url || linkModal.url.trim() === ''" class="text-gray-400">
                                    Keine URL eingegeben
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-between items-center gap-3 p-6 border-t border-gray-200">
                    <button x-show="linkModal.type === 'edit'" @click="removeLink()"
                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        Link entfernen
                    </button>
                    <div class="flex gap-3 ml-auto">
                        <button @click="closeLinkModal()"
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                            Abbrechen
                        </button>
                        <button @click="saveLink()"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            x-text="linkModal.type === 'edit' ? 'Link aktualisieren' : linkModal.type === 'block' ? 'Speichern' : 'Link hinzuf√ºgen'"></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Modal -->
        <div x-show="showConfirmModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeConfirmModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full flex flex-col" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-900" x-text="confirmModal.title"></h2>
                    <button @click="closeConfirmModal()" class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 overflow-y-auto p-6">
                    <p class="text-gray-700" x-html="confirmModal.message"></p>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <!-- Link-Follow Buttons -->
                    <template x-if="confirmModal.showLinkFollow">
                        <div class="flex gap-3 w-full">
                            <button @click="confirmModal.onCancel && confirmModal.onCancel()"
                                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors flex-1">
                                ‚úèÔ∏è Bearbeiten
                            </button>
                            <button @click="confirmModal.onConfirm && confirmModal.onConfirm()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex-1">
                                üîó Link folgen
                            </button>
                        </div>
                    </template>

                    <!-- Standard Buttons (wenn nicht Link-Follow) -->
                    <template x-if="!confirmModal.showLinkFollow">
                        <div class="flex gap-3">
                            <button @click="closeConfirmModal()"
                                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                                Abbrechen
                            </button>
                            <button x-show="confirmModal.showExtend"
                                @click="confirmModal.onExtend && confirmModal.onExtend()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                Erweitern
                            </button>
                            <button x-show="confirmModal.onConfirm && !confirmModal.showExtend" @click="confirmAction()"
                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                Best√§tigen
                            </button>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Image Settings Modal -->
        <div x-show="showImageSettingsModal" x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
            @click.self="closeImageSettingsModal()" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full flex flex-col" @click.stop
                x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95">
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900">üñºÔ∏è Bild-Einstellungen</h2>
                    <button @click="closeImageSettingsModal()"
                        class="p-2 hover:bg-gray-100 rounded-lg transition-colors" title="Schlie√üen">
                        <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Tabs -->
                <div class="border-b border-gray-200 px-6">
                    <div class="flex space-x-1">
                        <button @click="imageSettingsActiveTab = 'upload'"
                            :class="imageSettingsActiveTab === 'upload' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 text-sm font-medium transition-colors">
                            üìÅ Bild ausw√§hlen
                        </button>
                        <button @click="imageSettingsActiveTab = 'url'"
                            :class="imageSettingsActiveTab === 'url' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                            class="px-4 py-3 text-sm font-medium transition-colors">
                            üîó URL eingeben
                        </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- Tab: Bild ausw√§hlen -->
                    <div x-show="imageSettingsActiveTab === 'upload'" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Linke Spalte: Datei-Auswahl -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Bild ausw√§hlen:
                                </label>
                                <!-- Datei-Auswahl Bereich -->
                                <div @click.stop="selectImageFile(imageSettingsBlockId)"
                                    class="border-2 border-dashed border-gray-300 rounded-lg p-8 bg-gray-50 hover:bg-gray-100 hover:border-blue-400 transition-colors cursor-pointer text-center">
                                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <p class="text-sm font-medium text-gray-700 mb-1">Datei ausw√§hlen</p>
                                    <p class="text-xs text-gray-500">Klicken Sie hier, um ein Bild vom Computer
                                        auszuw√§hlen</p>
                                </div>
                            </div>

                            <!-- Rechte Spalte: Vorschau -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Vorschau:
                                </label>
                                <div
                                    class="border border-gray-300 rounded-lg p-4 bg-gray-50 min-h-[200px] flex items-center justify-center">
                                    <img x-show="imageSettingsUrl" :src="imageSettingsUrl" alt="Vorschau"
                                        class="max-w-full max-h-[300px] h-auto rounded mx-auto"
                                        @error="imageSettingsUrl = ''" />
                                    <div x-show="!imageSettingsUrl" class="text-center text-gray-400">
                                        <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        <p class="text-sm">Kein Bild ausgew√§hlt</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alt-Text und Titel -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200">
                            <!-- Alt-Text -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Alt-Text (f√ºr Barrierefreiheit):
                                </label>
                                <input type="text" x-model="imageSettingsAlt" @click.stop @focus.stop
                                    placeholder="Beschreibung des Bildes..."
                                    class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                <p class="mt-1 text-xs text-gray-500">
                                    Beschreibung des Bildes f√ºr Screenreader
                                </p>
                            </div>

                            <!-- Titel -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Titel (Tooltip):
                                </label>
                                <input type="text" x-model="imageSettingsTitle" @click.stop @focus.stop
                                    placeholder="Titel des Bildes..."
                                    class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                <p class="mt-1 text-xs text-gray-500">
                                    Wird beim Hovern √ºber das Bild angezeigt
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: URL eingeben -->
                    <div x-show="imageSettingsActiveTab === 'url'" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Linke Spalte: URL-Eingabe -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Bild-URL:
                                </label>
                                <input type="text" x-model="imageSettingsUrl" @click.stop @focus.stop
                                    placeholder="https://example.com/image.jpg"
                                    class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                <p class="mt-1 text-xs text-gray-500">
                                    Geben Sie eine URL zu einem Bild ein
                                </p>
                            </div>

                            <!-- Rechte Spalte: Vorschau -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Vorschau:
                                </label>
                                <div
                                    class="border border-gray-300 rounded-lg p-4 bg-gray-50 min-h-[200px] flex items-center justify-center">
                                    <img x-show="imageSettingsUrl" :src="imageSettingsUrl" alt="Vorschau"
                                        class="max-w-full max-h-[300px] h-auto rounded mx-auto"
                                        @error="imageSettingsUrl = ''" />
                                    <div x-show="!imageSettingsUrl" class="text-center text-gray-400">
                                        <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        <p class="text-sm">Kein Bild ausgew√§hlt</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alt-Text und Titel -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200">
                            <!-- Alt-Text -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Alt-Text (f√ºr Barrierefreiheit):
                                </label>
                                <input type="text" x-model="imageSettingsAlt" @click.stop @focus.stop
                                    placeholder="Beschreibung des Bildes..."
                                    class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                <p class="mt-1 text-xs text-gray-500">
                                    Beschreibung des Bildes f√ºr Screenreader
                                </p>
                            </div>

                            <!-- Titel -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Titel (Tooltip):
                                </label>
                                <input type="text" x-model="imageSettingsTitle" @click.stop @focus.stop
                                    placeholder="Titel des Bildes..."
                                    class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                                <p class="mt-1 text-xs text-gray-500">
                                    Wird beim Hovern √ºber das Bild angezeigt
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Footer -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button @click="closeImageSettingsModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        Abbrechen
                    </button>
                    <button @click="saveImageSettings()"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Speichern
                    </button>
                </div>
            </div>
        </div>

    </div>
    </div>


</body>

</html>