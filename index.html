<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import './block-editor.js';
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [contenteditable="true"]:focus {
            outline: none;
        }
        .block-placeholder:empty:before {
            content: attr(data-placeholder);
            color: #9ca3af;
        }
        .block-item[draggable="true"]:hover {
            cursor: move;
        }
        .block-item.drag-over {
            border-top: 2px solid #3b82f6;
            margin-top: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="blockEditor()" x-init="init()" class="flex h-screen overflow-hidden">
        <!-- Notification Component -->
        <div 
            x-show="notification.show"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 translate-y-2"
            x-transition:enter-end="opacity-100 translate-y-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 translate-y-0"
            x-transition:leave-end="opacity-0 translate-y-2"
            class="fixed top-4 right-4 z-50 max-w-sm w-full"
            @click="hideNotification()"
        >
            <div 
                :class="{
                    'bg-green-50 border-green-200 text-green-800': notification.type === 'success',
                    'bg-red-50 border-red-200 text-red-800': notification.type === 'error',
                    'bg-blue-50 border-blue-200 text-blue-800': notification.type === 'info',
                    'bg-yellow-50 border-yellow-200 text-yellow-800': notification.type === 'warning'
                }"
                class="border rounded-lg shadow-lg p-4 flex items-start gap-3 cursor-pointer hover:shadow-xl transition-shadow"
            >
                <div class="flex-shrink-0">
                    <svg 
                        x-show="notification.type === 'success'"
                        class="w-5 h-5 text-green-600" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <svg 
                        x-show="notification.type === 'error'"
                        class="w-5 h-5 text-red-600" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <svg 
                        x-show="notification.type === 'info'"
                        class="w-5 h-5 text-blue-600" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <svg 
                        x-show="notification.type === 'warning'"
                        class="w-5 h-5 text-yellow-600" 
                        fill="none" 
                        stroke="currentColor" 
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium" x-html="notification.message"></p>
                </div>
                <button 
                    @click.stop="hideNotification()"
                    class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Overlay f√ºr Sidebar (schlie√üt Sidebar beim Klick) -->
        <div 
            x-show="showSidebar"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            @click="closeSidebar()"
            class="fixed inset-0 bg-black bg-opacity-20 z-10"
        ></div>

        <!-- Sidebar f√ºr Block-Einstellungen -->
        <div 
            x-show="showSidebar"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="-translate-x-full opacity-0"
            x-transition:enter-end="translate-x-0 opacity-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="translate-x-0 opacity-100"
            x-transition:leave-end="-translate-x-full opacity-0"
            class="w-80 bg-white border-r border-gray-200 shadow-xl overflow-y-auto z-20 fixed left-0 top-0 h-screen"
            @click.stop
        >
            <template x-if="showSidebar">
                <div class="p-4" @click.stop>
                    <div class="flex justify-between items-center mb-4" @click.stop>
                        <h2 class="text-xl font-bold text-gray-900">Einstellungen</h2>
                        <button 
                            @click.stop="closeSidebar()"
                            class="p-1 hover:bg-gray-100 rounded"
                            title="Schlie√üen"
                        >
                            √ó
                        </button>
                    </div>

                    <!-- Tabs f√ºr Sidebar-Navigation -->
                    <div class="flex gap-2 mb-4 border-b border-gray-200" @click.stop>
                        <button 
                            @click.stop="sidebarTab = 'blocks'"
                            :class="sidebarTab === 'blocks' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                            class="px-4 py-2 font-semibold transition-colors"
                        >
                            Bl√∂cke
                        </button>
                        <button 
                            @click.stop="sidebarTab = 'themes'"
                            :class="sidebarTab === 'themes' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500 hover:text-gray-700'"
                            class="px-4 py-2 font-semibold transition-colors"
                        >
                            Themes
                        </button>
                    </div>

                    <!-- Themes Tab -->
                    <div x-show="sidebarTab === 'themes'" class="space-y-4" @click.stop>
                        <div class="flex gap-2">
                            <button 
                                @click.stop="openSaveThemeModal()"
                                class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 text-sm"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                Speichern
                            </button>
                            <button 
                                @click.stop="openImportThemeModal()"
                                class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 text-sm"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                Import
                            </button>
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">Gespeicherte Themes</h3>
                            <div class="space-y-2 max-h-96 overflow-y-auto">
                                <template x-for="theme in themes" :key="theme.name">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                        <div class="flex-1 min-w-0">
                                            <div class="font-medium text-gray-900 truncate" x-text="theme.name"></div>
                                            <div class="text-xs text-gray-500" x-text="new Date(theme.createdAt).toLocaleDateString('de-DE')"></div>
                                        </div>
                                        <div class="flex gap-1 ml-2">
                                            <button 
                                                @click.stop="loadTheme(theme.name)"
                                                class="p-1.5 bg-green-500 text-white rounded hover:bg-green-600 transition-colors"
                                                title="Theme laden"
                                            >
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                                </svg>
                                            </button>
                                            <button 
                                                @click.stop="openEditThemeModal(theme.name)"
                                                class="p-1.5 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors"
                                                title="Theme bearbeiten"
                                            >
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                                </svg>
                                            </button>
                                            <button 
                                                @click.stop="deleteTheme(theme.name)"
                                                class="p-1.5 bg-red-500 text-white rounded hover:bg-red-600 transition-colors"
                                                title="Theme l√∂schen"
                                            >
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </template>
                                <div x-show="themes.length === 0" class="text-center text-gray-500 py-8 text-sm">
                                    <p>Keine Themes gespeichert</p>
                                    <p class="text-xs mt-1">Speichere dein erstes Theme oben</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Blocks Tab -->
                    <div x-show="sidebarTab === 'blocks'">
                        <div x-show="selectedBlockId === null" class="text-center text-gray-500 py-8">
                            <p>Kein Block ausgew√§hlt</p>
                            <p class="text-sm mt-2">W√§hle einen Block aus, um seine Einstellungen zu bearbeiten</p>
                        </div>

                    <template x-for="block in getAllBlocks()" :key="block.id">
                        <div x-show="block.id === selectedBlockId" class="space-y-4">
                            <!-- Block-Typ √§ndern -->
                            <div @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Block-Typ:
                                </label>
                                <select 
                                    x-model="block.type"
                                    @change="changeBlockType(block.id, block.type)"
                                    @click.stop
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                                    <option value="paragraph">üìù Paragraph</option>
                                    <option value="heading1">H1 √úberschrift</option>
                                    <option value="heading2">H2 √úberschrift</option>
                                    <option value="heading3">H3 √úberschrift</option>
                                    <option value="code">üíª Code Block</option>
                                    <option value="quote">üí¨ Zitat</option>
                                    <option value="link">üîó Link</option>
                                    <option value="divider">‚ûñ Trennlinie</option>
                                    <option value="twoColumn">üìä Zwei Spalten</option>
                                    <option value="threeColumn">üìä Drei Spalten</option>
                                    <option value="table">üìã Tabelle</option>
                                </select>
                            </div>

                            <!-- Tailwind CSS Klassen Editor -->
                            <div @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tailwind CSS Klassen:
                                </label>
                                <input 
                                    type="text"
                                    x-model="block.classes"
                                    @input="block.updatedAt = new Date().toISOString()"
                                    @click.stop
                                    @focus.stop
                                    placeholder="z.B. text-red-500 bg-yellow-200 p-4 rounded-lg"
                                    class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                                <div class="mt-2 flex gap-2">
                                    <button 
                                        @click.stop="clearBlockClasses(block.id)"
                                        class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600"
                                    >
                                        Zur√ºcksetzen
                                    </button>
                                </div>
                                <div class="mt-2 text-xs text-gray-500">
                                    Beispiel: <code class="bg-gray-100 px-1 rounded">text-blue-600 bg-gray-100 p-4 rounded-lg shadow-md</code>
                                </div>
                            </div>

                            <!-- CSS Editor (Optional) -->
                            <div @click.stop class="pt-4 border-t border-gray-200">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Inline CSS (Optional):
                                </label>
                                <textarea 
                                    x-model="block.style"
                                    @input="block.updatedAt = new Date().toISOString()"
                                    @click.stop
                                    @focus.stop
                                    placeholder="z.B. color: red; background-color: yellow; padding: 10px;"
                                    class="w-full p-2 border border-gray-300 rounded-lg font-mono text-sm h-32 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                ></textarea>
                                <div class="mt-2 flex gap-2">
                                    <button 
                                        @click.stop="clearBlockStyle(block.id)"
                                        class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600"
                                    >
                                        Zur√ºcksetzen
                                    </button>
                                </div>
                                <div class="mt-2 text-xs text-gray-500">
                                    Beispiel: <code class="bg-gray-100 px-1 rounded">color: blue; font-size: 18px; margin: 10px;</code>
                                </div>
                            </div>

                            <!-- Link Management -->
                            <div x-show="block.type === 'link'" class="pt-4 border-t border-gray-200" @click.stop>
                                <button 
                                    @click.stop="openLinkSettingsModal(block.id)"
                                    class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
                                >
                                    üîó Link-Einstellungen √∂ffnen
                                </button>
                            </div>

                            <!-- Table Management -->
                            <div x-show="block.type === 'table'" class="pt-4 border-t border-gray-200" @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Tabellen-Einstellungen:
                                </label>
                                
                                <!-- Header/Footer Toggle -->
                                <div class="mb-4 space-y-2">
                                    <div class="flex items-center gap-2">
                                        <input 
                                            type="checkbox"
                                            :checked="block.tableData?.hasHeader || false"
                                            @change="toggleTableHeader(block.id)"
                                            @click.stop
                                            class="w-4 h-4"
                                        />
                                        <label class="text-sm text-gray-700">Header aktivieren</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input 
                                            type="checkbox"
                                            :checked="block.tableData?.hasFooter || false"
                                            @change="toggleTableFooter(block.id)"
                                            @click.stop
                                            class="w-4 h-4"
                                        />
                                        <label class="text-sm text-gray-700">Footer aktivieren</label>
                                    </div>
                                </div>

                                <!-- Row Management -->
                                <div class="mb-4">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2">Zeilen:</label>
                                    <div class="flex gap-2">
                                        <button 
                                            @click.stop="addTableRow(block.id, 'top')"
                                            class="flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600"
                                        >
                                            + Oben
                                        </button>
                                        <button 
                                            @click.stop="addTableRow(block.id, 'bottom')"
                                            class="flex-1 px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600"
                                        >
                                            + Unten
                                        </button>
                                    </div>
                                    <div class="mt-2 flex gap-2">
                                        <button 
                                            @click.stop="removeTableRow(block.id, 0)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || block.tableData.cells.length <= 1"
                                        >
                                            - Erste Zeile
                                        </button>
                                        <button 
                                            @click.stop="removeTableRow(block.id, (block.tableData?.cells || []).length - 1)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || block.tableData.cells.length <= 1"
                                        >
                                            - Letzte Zeile
                                        </button>
                                    </div>
                                </div>

                                <!-- Column Management -->
                                <div class="mb-4">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2">Spalten:</label>
                                    <div class="flex gap-2">
                                        <button 
                                            @click.stop="addTableColumn(block.id, 'left')"
                                            class="flex-1 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600"
                                        >
                                            + Links
                                        </button>
                                        <button 
                                            @click.stop="addTableColumn(block.id, 'right')"
                                            class="flex-1 px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600"
                                        >
                                            + Rechts
                                        </button>
                                    </div>
                                    <div class="mt-2 flex gap-2">
                                        <button 
                                            @click.stop="removeTableColumn(block.id, 0)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || (block.tableData.cells[0]?.length || 0) <= 1"
                                        >
                                            - Erste Spalte
                                        </button>
                                        <button 
                                            @click.stop="removeTableColumn(block.id, (block.tableData?.cells[0]?.length || 1) - 1)"
                                            class="flex-1 px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            :disabled="!block.tableData || (block.tableData.cells[0]?.length || 0) <= 1"
                                        >
                                            - Letzte Spalte
                                        </button>
                                    </div>
                                </div>

                                <!-- Cell Merge Instructions -->
                                <div class="mb-4 p-2 bg-blue-50 rounded text-xs text-gray-600">
                                    <strong>Zellen verbinden:</strong> W√§hle eine Zelle aus und verwende die Kontextmen√º-Optionen oder markiere mehrere Zellen f√ºr das Verbinden.
                                </div>

                                <!-- Table Info -->
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>Zeilen:</strong> <span x-text="(block.tableData?.cells || []).length || 0"></span></div>
                                    <div><strong>Spalten:</strong> <span x-text="(block.tableData?.cells[0]?.length || 0)"></span></div>
                                </div>
                            </div>

                            <!-- Children Management -->
                            <div class="pt-4 border-t border-gray-200" @click.stop>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    Children (Verschachtelte Bl√∂cke):
                                </label>
                                <div class="space-y-2 mb-2">
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div class="flex items-center gap-2 p-2 bg-gray-50 rounded" @click.stop>
                                            <span class="text-xs text-gray-600 flex-1" x-text="child.type + ': ' + (child.content || 'leer')"></span>
                                            <button 
                                                @click.stop="removeChild(block.id, childIndex)"
                                                class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600"
                                            >
                                                √ó
                                            </button>
                                        </div>
                                    </template>
                                    <div x-show="!block.children || block.children.length === 0" class="text-xs text-gray-400 italic">
                                        Keine Children vorhanden
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <select 
                                        x-ref="childTypeSelect"
                                        @click.stop
                                        @change.stop
                                        class="flex-1 p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="paragraph">üìù Paragraph</option>
                                        <option value="heading1">H1 √úberschrift</option>
                                        <option value="heading2">H2 √úberschrift</option>
                                        <option value="heading3">H3 √úberschrift</option>
                                        <option value="code">üíª Code Block</option>
                                        <option value="quote">üí¨ Zitat</option>
                                    </select>
                                    <button 
                                        @click.stop="addChild(block.id, $refs.childTypeSelect.value)"
                                        class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700"
                                    >
                                        + Child
                                    </button>
                                </div>
                            </div>

                            <!-- Block-Info -->
                            <div class="pt-4 border-t border-gray-200" @click.stop>
                                <div class="text-xs text-gray-500 space-y-1">
                                    <div><strong>ID:</strong> <span x-text="block.id"></span></div>
                                    <div x-show="block.createdAt"><strong>Erstellt:</strong> <span x-text="new Date(block.createdAt).toLocaleString('de-DE')"></span></div>
                                    <div x-show="block.updatedAt"><strong>Ge√§ndert:</strong> <span x-text="new Date(block.updatedAt).toLocaleString('de-DE')"></span></div>
                                    <div><strong>Children:</strong> <span x-text="(block.children || []).length"></span></div>
                                </div>
                            </div>
                        </div>
                    </template>
                    </div>
                </div>
            </template>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto transition-all duration-300" :class="selectedBlockId !== null ? 'ml-80' : ''">
            <div class="max-w-4xl mx-auto py-8 px-4">
                <!-- Header -->
                <div class="mb-8 flex justify-between items-center">
                    <h1 class="text-3xl font-bold text-gray-900">Block Editor</h1>
                    <div class="flex gap-2">
                        <button 
                            @click="openSidebar()"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2"
                            title="Einstellungen √∂ffnen"
                        >
                            ‚öô Einstellungen
                        </button>
                        <button 
                            @click="saveToJSON()" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            Speichern
                        </button>
                        <button 
                            @click="loadFromJSON()" 
                            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                        >
                            Laden
                        </button>
                        <button 
                            @click="exportJSON()" 
                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                        >
                            JSON Export
                        </button>
                        <button 
                            @click="importJSON()" 
                            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                        >
                            JSON Import
                        </button>
                    </div>
                </div>

                <!-- Editor Container -->
                <div class="bg-white rounded-lg shadow-lg p-6 min-h-[600px]">
                    <!-- Toolbar f√ºr neuen Block -->
            <div 
                x-show="showToolbar"
                x-transition
                class="mb-4 p-2 bg-gray-100 rounded-lg"
            >
                <!-- Block-Typen -->
                <div class="flex gap-2 flex-wrap mb-3">
                    <button 
                        @click="addBlock('paragraph')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üìù Paragraph
                    </button>
                    <button 
                        @click="addBlock('heading1')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        H1 √úberschrift
                    </button>
                    <button 
                        @click="addBlock('heading2')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        H2 √úberschrift
                    </button>
                    <button 
                        @click="addBlock('heading3')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        H3 √úberschrift
                    </button>
                    <button 
                        @click="addBlock('code')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üíª Code Block
                    </button>
                    <button 
                        @click="addBlock('quote')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üí¨ Zitat
                    </button>
                    <button 
                        @click="addBlock('link')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üîó Link
                    </button>
                    <button 
                        @click="addBlock('divider')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        ‚ûñ Trennlinie
                    </button>
                    <button 
                        @click="addBlock('twoColumn')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üìä Zwei Spalten
                    </button>
                    <button 
                        @click="addBlock('threeColumn')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üìä Drei Spalten
                    </button>
                    <button 
                        @click="addBlock('table')"
                        class="px-3 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                    >
                        üìã Tabelle
                    </button>
                </div>

                <!-- Theme-Vorlagen -->
                <div class="border-t border-gray-300 pt-3">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs font-semibold text-gray-600">üé® Theme-Vorlagen:</span>
                        <button 
                            @click.stop="showThemeDropdown = !showThemeDropdown"
                            class="text-xs text-blue-600 hover:text-blue-800 flex items-center gap-1"
                        >
                            <span x-text="showThemeDropdown ? 'Ausblenden' : 'Anzeigen'"></span>
                            <svg 
                                class="w-4 h-4 transition-transform"
                                :class="showThemeDropdown ? 'rotate-180' : ''"
                                fill="none" 
                                stroke="currentColor" 
                                viewBox="0 0 24 24"
                            >
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                    </div>
                    <div 
                        x-show="showThemeDropdown"
                        x-transition:enter="transition ease-out duration-200"
                        x-transition:enter-start="opacity-0 max-h-0"
                        x-transition:enter-end="opacity-100 max-h-96"
                        x-transition:leave="transition ease-in duration-150"
                        x-transition:leave-start="opacity-100 max-h-96"
                        x-transition:leave-end="opacity-0 max-h-0"
                        class="overflow-hidden"
                    >
                        <div class="space-y-1 max-h-64 overflow-y-auto">
                            <template x-for="theme in themes" :key="theme.name">
                                <button 
                                    @click.stop="loadThemeFromToolbar(theme.name)"
                                    class="w-full px-3 py-2 bg-white rounded hover:bg-blue-50 text-left text-sm flex items-center justify-between group transition-colors"
                                >
                                    <div class="flex-1 min-w-0">
                                        <div class="font-medium text-gray-900 truncate" x-text="theme.name"></div>
                                        <div class="text-xs text-gray-500" x-text="(theme.data || []).length + ' Bl√∂cke'"></div>
                                    </div>
                                    <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                    </svg>
                                </button>
                            </template>
                            <div x-show="themes.length === 0" class="px-3 py-2 text-xs text-gray-500 text-center">
                                Keine Themes verf√ºgbar
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blocks Container -->
            <div class="space-y-2">
                <template x-for="(block, index) in blocks" :key="block.id">
                    <!-- Render Block with Children -->
                    <div>
                        <!-- Main Block -->
                    <div 
                        :class="{
                            'ring-2 ring-blue-500': selectedBlockId === block.id,
                            'opacity-50': draggingBlockId === block.id,
                            'drag-over': dragOverIndex && dragOverIndex.type === 'main' && dragOverIndex.index === index && (!dragStartIndex || dragStartIndex.index !== index)
                        }"
                        class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move"
                        @click.stop="selectBlock(block.id)"
                        @mouseenter="hoveredBlockId = block.id"
                        @mouseleave="hoveredBlockId = null"
                        draggable="true"
                        @dragstart="handleDragStart($event, index)"
                        @dragover.prevent="handleDragOver($event, index)"
                        @drop="handleDrop($event, index)"
                        @dragend="handleDragEnd()"
                        @dragleave="dragOverIndex = null"
                    >
                        <!-- Visual Indicator f√ºr ausgew√§hlten Block -->
                        <div 
                            x-show="selectedBlockId === block.id"
                            class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"
                        ></div>
                        <!-- Block Controls -->
                        <div 
                            x-show="hoveredBlockId === block.id || selectedBlockId === block.id"
                            class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10"
                        >
                            <button 
                                @click.stop="openSidebar(block.id)"
                                class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs"
                                title="Einstellungen √∂ffnen"
                            >
                                ‚öô
                            </button>
                            <button 
                                @click.stop="moveBlock(index, 'up')"
                                :disabled="index === 0"
                                :class="index === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                                class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                title="Nach oben"
                            >
                                ‚Üë
                            </button>
                            <button 
                                @click.stop="moveBlock(index, 'down')"
                                :disabled="index === blocks.length - 1"
                                :class="index === blocks.length - 1 ? 'opacity-50 cursor-not-allowed' : ''"
                                class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                title="Nach unten"
                            >
                                ‚Üì
                            </button>
                            <button 
                                @click.stop="deleteBlock(block.id)"
                                class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600"
                                title="L√∂schen"
                            >
                                √ó
                            </button>
                        </div>

                        <!-- Text-Ausrichtung f√ºr Text-Bl√∂cke -->
                        <div 
                            x-show="selectedBlockId === block.id && (block.type === 'paragraph' || block.type === 'heading1' || block.type === 'heading2' || block.type === 'heading3' || block.type === 'quote')"
                            class="mb-2 p-2 bg-gray-100 rounded-lg flex gap-1 flex-wrap"
                            @click.stop
                        >
                            <span class="text-xs text-gray-600 self-center mr-2">Text-Ausrichtung:</span>
                            <button 
                                @click.stop="applyTextAlignment(block.id, 'left')"
                                class="px-2 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                                title="Links ausrichten"
                            >
                                ‚¨Ö
                            </button>
                            <button 
                                @click.stop="applyTextAlignment(block.id, 'center')"
                                class="px-2 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                                title="Zentriert"
                            >
                                ‚¨å
                            </button>
                            <button 
                                @click.stop="applyTextAlignment(block.id, 'right')"
                                class="px-2 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                                title="Rechts ausrichten"
                            >
                                ‚û°
                            </button>
                            <button 
                                @click.stop="applyTextAlignment(block.id, 'justify')"
                                class="px-2 py-1 bg-white rounded hover:bg-gray-200 text-sm"
                                title="B√ºndig"
                            >
                                ‚¨å‚¨å
                            </button>
                        </div>

                        <!-- Block Content -->
                        <div class="block-content">
                            <!-- Paragraph -->
                            <div x-show="block.type === 'paragraph'">
                                <div 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder min-h-[1.5rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="Schreibe einen Absatz..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></div>
                            </div>

                            <!-- Heading 1 -->
                            <div x-show="block.type === 'heading1'">
                                <h1 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-3xl font-bold mb-2 min-h-[2rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="√úberschrift 1..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></h1>
                            </div>

                            <!-- Heading 2 -->
                            <div x-show="block.type === 'heading2'">
                                <h2 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="√úberschrift 2..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></h2>
                            </div>

                            <!-- Heading 3 -->
                            <div x-show="block.type === 'heading3'">
                                <h3 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="√úberschrift 3..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></h3>
                            </div>

                            <!-- Code Block -->
                            <div x-show="block.type === 'code'">
                                <pre 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder bg-gray-900 text-green-400 p-4 rounded font-mono text-sm min-h-[4rem] whitespace-pre-wrap', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="Schreibe Code..."
                                    @input="updateBlockContent(block.id, $event.target.textContent)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block, true)"
                                ></pre>
                            </div>

                            <!-- Quote -->
                            <div x-show="block.type === 'quote'">
                                <blockquote 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['block-placeholder border-l-4 border-blue-500 pl-4 italic text-gray-700 min-h-[1.5rem]', block.classes || '']"
                                    contenteditable="true"
                                    data-placeholder="Zitat..."
                                    @input="updateBlockContent(block.id, $event.target.innerHTML)"
                                    @keydown.enter.prevent="addBlockAfter(block.id, 'paragraph')"
                                    @keydown.backspace="handleBackspace(block.id, $event)"
                                    @focus="initBlockContent($event.target, block)"
                                ></blockquote>
                            </div>

                            <!-- Link -->
                            <div x-show="block.type === 'link'" class="flex items-center gap-2">
                                <a 
                                    :data-block-id="block.id"
                                    :href="block.linkUrl || '#'"
                                    :style="block.style || ''"
                                    :class="['block-placeholder text-blue-600 underline hover:text-blue-800 min-h-[1.5rem]', block.classes || '']"
                                    x-text="block.linkText || 'Link-Text'"
                                    @click.stop="openLinkSettingsModal(block.id)"
                                    class="cursor-pointer"
                                ></a>
                                <button 
                                    @click.stop="openLinkSettingsModal(block.id)"
                                    class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200"
                                    title="Link-Einstellungen √∂ffnen"
                                >
                                    ‚öô
                                </button>
                            </div>

                            <!-- Divider -->
                            <div x-show="block.type === 'divider'">
                                <hr class="border-t-2 border-gray-300 my-4">
                            </div>

                            <!-- Two Column -->
                            <div x-show="block.type === 'twoColumn'" class="grid grid-cols-2 gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg min-h-[200px]">
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 1</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 2 === 0" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Spalte 1 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap', child.classes || '']" contenteditable="true" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 0, 2)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 2</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 2 === 1" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder min-h-[1.5rem] text-sm" data-placeholder="Spalte 2 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 1, 2)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                            </div>

                            <!-- Table -->
                            <div x-show="block.type === 'table'" class="overflow-x-auto">
                                <table 
                                    :data-block-id="block.id"
                                    :style="block.style || ''"
                                    :class="['w-full border-collapse border border-gray-300', block.classes || '']"
                                >
                                    <!-- Header -->
                                    <thead x-show="block.tableData && block.tableData.hasHeader">
                                        <template x-for="(row, rowIndex) in (block.tableData?.cells || []).filter(r => r[0]?.isHeader)" :key="rowIndex">
                                            <tr>
                                                <template x-for="(cell, colIndex) in row" :key="cell.id">
                                                    <th 
                                                        x-show="!cell.merged"
                                                        :colspan="cell.colspan > 1 ? cell.colspan : null"
                                                        :rowspan="cell.rowspan > 1 ? cell.rowspan : null"
                                                        :data-cell-id="cell.id"
                                                        :data-block-id="block.id"
                                                        :data-row-index="rowIndex"
                                                        :data-col-index="colIndex"
                                                        class="border border-gray-300 p-2 bg-gray-100 font-semibold text-left min-w-[100px] min-h-[40px]"
                                                        contenteditable="true"
                                                        @input="updateTableCellContent(block.id, cell.id, $event.target.innerHTML)"
                                                        @focus="selectBlock(block.id); initTableCellContent($event.target, cell)"
                                                    ></th>
                                                </template>
                                            </tr>
                                        </template>
                                    </thead>
                                    
                                    <!-- Body -->
                                    <tbody>
                                        <template x-for="(row, rowIndex) in (block.tableData?.cells || []).filter(r => !r[0]?.isHeader && !r[0]?.isFooter)" :key="rowIndex">
                                            <tr>
                                                <template x-for="(cell, colIndex) in row" :key="cell.id">
                                                    <td 
                                                        x-show="!cell.merged"
                                                        :colspan="cell.colspan > 1 ? cell.colspan : null"
                                                        :rowspan="cell.rowspan > 1 ? cell.rowspan : null"
                                                        :data-cell-id="cell.id"
                                                        :data-block-id="block.id"
                                                        :data-row-index="rowIndex"
                                                        :data-col-index="colIndex"
                                                        class="border border-gray-300 p-2 min-w-[100px] min-h-[40px]"
                                                        contenteditable="true"
                                                        @input="updateTableCellContent(block.id, cell.id, $event.target.innerHTML)"
                                                        @focus="selectBlock(block.id); initTableCellContent($event.target, cell)"
                                                    ></td>
                                                </template>
                                            </tr>
                                        </template>
                                    </tbody>
                                    
                                    <!-- Footer -->
                                    <tfoot x-show="block.tableData && block.tableData.hasFooter">
                                        <template x-for="(row, rowIndex) in (block.tableData?.cells || []).filter(r => r[0]?.isFooter)" :key="rowIndex">
                                            <tr>
                                                <template x-for="(cell, colIndex) in row" :key="cell.id">
                                                    <td 
                                                        x-show="!cell.merged"
                                                        :colspan="cell.colspan > 1 ? cell.colspan : null"
                                                        :rowspan="cell.rowspan > 1 ? cell.rowspan : null"
                                                        :data-cell-id="cell.id"
                                                        :data-block-id="block.id"
                                                        :data-row-index="rowIndex"
                                                        :data-col-index="colIndex"
                                                        class="border border-gray-300 p-2 bg-gray-50 font-semibold min-w-[100px] min-h-[40px]"
                                                        contenteditable="true"
                                                        @input="updateTableCellContent(block.id, cell.id, $event.target.innerHTML)"
                                                        @focus="selectBlock(block.id); initTableCellContent($event.target, cell)"
                                                    ></td>
                                                </template>
                                            </tr>
                                        </template>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- Three Column -->
                            <div x-show="block.type === 'threeColumn'" class="grid grid-cols-3 gap-4 p-4 border-2 border-dashed border-gray-300 rounded-lg min-h-[200px]">
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 1</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 3 === 0" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Spalte 1 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]', child.classes || '']" contenteditable="true" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap', child.classes || '']" contenteditable="true" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" :class="['block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm', child.classes || '']" contenteditable="true" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 0, 3)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 2</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 3 === 1" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder min-h-[1.5rem] text-sm" data-placeholder="Spalte 2 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 1, 3)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                                <div class="space-y-2">
                                    <div class="text-xs font-semibold text-gray-500 mb-2">Spalte 3</div>
                                    <template x-for="(child, childIndex) in (block.children || [])" :key="child.id">
                                        <div x-show="childIndex % 3 === 2" 
                                            :class="{
                                                'ring-2 ring-blue-500': selectedBlockId === child.id,
                                                'opacity-50': draggingBlockId === child.id
                                            }"
                                            class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                            @click.stop="selectBlock(child.id)"
                                            @mouseenter="hoveredBlockId = child.id"
                                            @mouseleave="hoveredBlockId = null"
                                            draggable="true"
                                            @dragstart="handleDragStart($event, index, childIndex)"
                                            @dragover.prevent="handleDragOver($event, index, childIndex)"
                                            @drop="handleDrop($event, index, childIndex)"
                                            @dragend="handleDragEnd()"
                                        >
                                            <div x-show="selectedBlockId === child.id" class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"></div>
                                            <div x-show="hoveredBlockId === child.id || selectedBlockId === child.id" class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                                                <button @click.stop="openSidebar(child.id)" class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs" title="Einstellungen √∂ffnen">‚öô</button>
                                                <button @click.stop="removeChild(block.id, childIndex)" class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600" title="L√∂schen">√ó</button>
                                            </div>
                                            <div class="block-content">
                                                <div x-show="child.type === 'paragraph'">
                                                    <div :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder min-h-[1.5rem] text-sm" data-placeholder="Spalte 3 Inhalt..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></div>
                                                </div>
                                                <div x-show="child.type === 'heading1'">
                                                    <h1 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h1>
                                                </div>
                                                <div x-show="child.type === 'heading2'">
                                                    <h2 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h2>
                                                </div>
                                                <div x-show="child.type === 'heading3'">
                                                    <h3 :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]" data-placeholder="√úberschrift..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></h3>
                                                </div>
                                                <div x-show="child.type === 'code'">
                                                    <pre :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap" data-placeholder="Code..." @input="updateBlockContent(child.id, $event.target.textContent)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child, true)"></pre>
                                                </div>
                                                <div x-show="child.type === 'quote'">
                                                    <blockquote :data-block-id="child.id" :style="child.style || ''" contenteditable="true" class="block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm" data-placeholder="Zitat..." @input="updateBlockContent(child.id, $event.target.innerHTML)" @keydown.backspace="handleBackspace(child.id, $event)" @focus="initBlockContent($event.target, child)"></blockquote>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    <button @click.stop="addChildToColumn(block.id, 'paragraph', 2, 3)" class="w-full mt-2 p-2 border border-dashed border-gray-400 rounded text-xs text-gray-500 hover:border-blue-500 hover:text-blue-500">+ Inhalt hinzuf√ºgen</button>
                                </div>
                            </div>
                        </div>

                        <!-- Children Blocks (Verschachtelt) -->
                        <div x-show="block.children && block.children.length > 0 && block.type !== 'twoColumn' && block.type !== 'threeColumn'" class="ml-8 mt-2 space-y-2 border-l-2 border-gray-300 pl-4">
                            <template x-for="(child, childIndex) in block.children" :key="child.id">
                                <div 
                                    :class="{
                                        'ring-2 ring-blue-500': selectedBlockId === child.id,
                                        'opacity-50': draggingBlockId === child.id,
                                        'drag-over': dragOverIndex && dragOverIndex.type === 'child' && dragOverIndex.parentIndex === index && dragOverIndex.childIndex === childIndex && (!dragStartIndex || dragStartIndex.childIndex !== childIndex)
                                    }"
                                    class="block-item group relative p-2 rounded-lg hover:bg-gray-50 transition-all cursor-move bg-gray-50"
                                    @click.stop="selectBlock(child.id)"
                                    @mouseenter="hoveredBlockId = child.id"
                                    @mouseleave="hoveredBlockId = null"
                                    draggable="true"
                                    @dragstart="handleDragStart($event, index, childIndex)"
                                    @dragover.prevent="handleDragOver($event, index, childIndex)"
                                    @drop="handleDrop($event, index, childIndex)"
                                    @dragend="handleDragEnd()"
                                >
                                    <!-- Visual Indicator f√ºr ausgew√§hlten Child Block -->
                                    <div 
                                        x-show="selectedBlockId === child.id"
                                        class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 rounded-l"
                                    ></div>

                                    <!-- Child Block Controls -->
                                    <div 
                                        x-show="hoveredBlockId === child.id || selectedBlockId === child.id"
                                        class="absolute -left-10 top-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10"
                                    >
                                        <button 
                                            @click.stop="openSidebar(child.id)"
                                            class="p-1 bg-blue-500 text-white rounded shadow hover:bg-blue-600 text-xs"
                                            title="Einstellungen √∂ffnen"
                                        >
                                            ‚öô
                                        </button>
                                        <button 
                                            @click.stop="moveChildBlock(block.id, childIndex, 'up')"
                                            :disabled="childIndex === 0"
                                            :class="childIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                                            class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                            title="Nach oben"
                                        >
                                            ‚Üë
                                        </button>
                                        <button 
                                            @click.stop="moveChildBlock(block.id, childIndex, 'down')"
                                            :disabled="childIndex === (block.children.length - 1)"
                                            :class="childIndex === (block.children.length - 1) ? 'opacity-50 cursor-not-allowed' : ''"
                                            class="p-1 bg-white rounded shadow hover:bg-gray-100"
                                            title="Nach unten"
                                        >
                                            ‚Üì
                                        </button>
                                        <button 
                                            @click.stop="removeChild(block.id, childIndex)"
                                            class="p-1 bg-red-500 text-white rounded shadow hover:bg-red-600"
                                            title="L√∂schen"
                                        >
                                            √ó
                                        </button>
                                    </div>

                                    <!-- Child Block Content -->
                                    <div class="block-content">
                                        <!-- Child Paragraph -->
                                        <div x-show="child.type === 'paragraph'">
                                            <div 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder min-h-[1.5rem] text-sm', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child Absatz..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></div>
                                        </div>

                                        <!-- Child Heading 1 -->
                                        <div x-show="child.type === 'heading1'">
                                            <h1 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder text-2xl font-bold mb-2 min-h-[1.75rem]', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child √úberschrift 1..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></h1>
                                        </div>

                                        <!-- Child Heading 2 -->
                                        <div x-show="child.type === 'heading2'">
                                            <h2 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder text-xl font-bold mb-2 min-h-[1.5rem]', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child √úberschrift 2..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></h2>
                                        </div>

                                        <!-- Child Heading 3 -->
                                        <div x-show="child.type === 'heading3'">
                                            <h3 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder text-lg font-bold mb-2 min-h-[1.5rem]', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child √úberschrift 3..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></h3>
                                        </div>

                                        <!-- Child Code Block -->
                                        <div x-show="child.type === 'code'">
                                            <pre 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder bg-gray-900 text-green-400 p-3 rounded font-mono text-xs min-h-[3rem] whitespace-pre-wrap', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child Code..."
                                                @input="updateBlockContent(child.id, $event.target.textContent)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child, true)"
                                            ></pre>
                                        </div>

                                        <!-- Child Quote -->
                                        <div x-show="child.type === 'quote'">
                                            <blockquote 
                                                :data-block-id="child.id"
                                                :style="child.style || ''"
                                                :class="['block-placeholder border-l-4 border-blue-500 pl-3 italic text-gray-700 min-h-[1.5rem] text-sm', child.classes || '']"
                                                contenteditable="true"
                                                data-placeholder="Child Zitat..."
                                                @input="updateBlockContent(child.id, $event.target.innerHTML)"
                                                @keydown.enter.prevent="addChildAfter(block.id, childIndex, 'paragraph')"
                                                @keydown.backspace="handleBackspace(child.id, $event)"
                                                @focus="initBlockContent($event.target, child)"
                                            ></blockquote>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>

                <!-- Add Block Button -->
                <div 
                    @click="showToolbar = true; showThemeDropdown = false"
                    class="mt-4 p-4 border-2 border-dashed border-gray-300 rounded-lg text-center text-gray-500 hover:border-blue-500 hover:text-blue-500 cursor-pointer transition-colors"
                >
                    + Block hinzuf√ºgen
                </div>
            </div>
        </div>

        <!-- JSON Display (for debugging) -->
        <div class="mt-8 bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-auto max-h-64">
            <pre x-text="JSON.stringify(blocks, null, 2)"></pre>
        </div>
    </div>

    <!-- JSON Import Modal -->
    <div 
        x-show="showImportModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeImportModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">JSON Import</h2>
                <button 
                    @click="closeImportModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-hidden flex flex-col p-6">
                <!-- JSON Input Area -->
                <div class="flex-1 flex flex-col mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        JSON eingeben oder einf√ºgen:
                    </label>
                    <textarea
                        x-model="importJSONText"
                        @input="validateImportJSON()"
                        class="flex-1 w-full p-4 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"
                        placeholder='[{"id": "block-1-1234567890", "type": "paragraph", "content": "Beispiel..."}]'
                        spellcheck="false"
                    ></textarea>
                </div>

                <!-- Validation Status -->
                <div class="mb-4">
                    <div x-show="importJSONError" class="p-3 bg-red-50 border border-red-200 rounded-lg">
                        <div class="flex items-start gap-2">
                            <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-red-800 mb-1">JSON Fehler:</p>
                                <p class="text-sm text-red-700" x-text="importJSONError"></p>
                            </div>
                        </div>
                    </div>
                    <div x-show="!importJSONError && importJSONText && importJSONValid" class="p-3 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center gap-2">
                            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <p class="text-sm font-semibold text-green-800">JSON ist g√ºltig!</p>
                        </div>
                    </div>
                    <div x-show="!importJSONText" class="p-3 bg-gray-50 border border-gray-200 rounded-lg">
                        <p class="text-sm text-gray-600">Geben Sie JSON-Daten ein, um sie zu importieren.</p>
                    </div>
                </div>

                <!-- Preview Info -->
                <div x-show="importJSONValid && importJSONPreview" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm font-semibold text-blue-800 mb-1">Vorschau:</p>
                    <p class="text-sm text-blue-700">
                        <span x-text="importJSONPreview.blockCount"></span> Block(s) werden importiert
                    </p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button 
                    @click="closeImportModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Abbrechen
                </button>
                <button 
                    @click="confirmImportJSON()"
                    :disabled="!importJSONValid || !importJSONText"
                    :class="(!importJSONValid || !importJSONText) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-purple-700'"
                    class="px-4 py-2 bg-purple-600 text-white rounded-lg transition-colors"
                >
                    Importieren
                </button>
            </div>
        </div>
    </div>

    <!-- Save Theme Modal -->
    <div 
        x-show="showSaveThemeModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeSaveThemeModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">Theme speichern</h2>
                <button 
                    @click="closeSaveThemeModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Theme-Name:
                    </label>
                    <input
                        type="text"
                        x-model="newThemeName"
                        @keydown.enter="saveTheme()"
                        @keydown.escape="closeSaveThemeModal()"
                        placeholder="z.B. Mein Theme"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        autofocus
                    />
                    <div x-show="saveThemeError" class="mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700">
                        <span x-text="saveThemeError"></span>
                    </div>
                </div>
                <div class="text-sm text-gray-600 mb-4">
                    <p>Das aktuelle Layout wird als Theme gespeichert.</p>
                    <p class="mt-1"><strong>Bl√∂cke:</strong> <span x-text="blocks.length"></span></p>
                    <p class="mt-1 text-xs text-gray-500">Die Datei wird im themes Ordner gespeichert.</p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button 
                    @click="closeSaveThemeModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Abbrechen
                </button>
                <button 
                    @click="saveTheme()"
                    :disabled="!newThemeName || !newThemeName.trim()"
                    :class="(!newThemeName || !newThemeName.trim()) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-700'"
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg transition-colors"
                >
                    Speichern
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Theme Modal -->
    <div 
        x-show="showEditThemeModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeEditThemeModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">Theme bearbeiten</h2>
                <button 
                    @click="closeEditThemeModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Theme-Name:
                    </label>
                    <input
                        type="text"
                        x-model="editThemeName"
                        @keydown.enter="updateTheme()"
                        @keydown.escape="closeEditThemeModal()"
                        placeholder="Theme-Name"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        autofocus
                    />
                    <div x-show="editThemeError" class="mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700">
                        <span x-text="editThemeError"></span>
                    </div>
                </div>
                <div class="text-sm text-gray-600 mb-4">
                    <p>√Ñndere den Namen des Themes. Die Datei wird beim n√§chsten Speichern aktualisiert.</p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button 
                    @click="closeEditThemeModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Abbrechen
                </button>
                <button 
                    @click="updateTheme()"
                    :disabled="!editThemeName || !editThemeName.trim()"
                    :class="(!editThemeName || !editThemeName.trim()) ? 'opacity-50 cursor-not-allowed' : 'hover:bg-yellow-700'"
                    class="px-4 py-2 bg-yellow-600 text-white rounded-lg transition-colors"
                >
                    Speichern
                </button>
            </div>
        </div>
    </div>

    <!-- Import Theme Modal -->
    <div 
        x-show="showImportThemeModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeImportThemeModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">Theme importieren</h2>
                <button 
                    @click="closeImportThemeModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        JSON-Datei ausw√§hlen:
                    </label>
                    <input
                        type="file"
                        accept=".json"
                        @change="handleThemeFileImport($event)"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                    />
                </div>
                <div class="text-sm text-gray-600 mb-4">
                    <p>W√§hle eine JSON-Datei aus dem themes Ordner aus, um ein Theme zu importieren.</p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button 
                    @click="closeImportThemeModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Schlie√üen
                </button>
            </div>
        </div>
    </div>

    <!-- JSON Export Modal -->
    <div 
        x-show="showExportModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeExportModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] flex flex-col"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">JSON Export</h2>
                <button 
                    @click="closeExportModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-hidden flex flex-col p-6">
                <!-- JSON Display Area -->
                <div class="flex-1 flex flex-col mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-semibold text-gray-700">
                            Aktuelles Editor JSON:
                        </label>
                        <div class="text-sm text-gray-500">
                            <span x-text="blocks.length"></span> Block(s)
                        </div>
                    </div>
                    <textarea
                        x-ref="exportJSONTextarea"
                        x-model="exportJSONText"
                        readonly
                        class="flex-1 w-full p-4 border border-gray-300 rounded-lg font-mono text-sm bg-gray-50 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        spellcheck="false"
                    ></textarea>
                </div>

                <!-- Info -->
                <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm text-blue-800">
                        <strong>Tipp:</strong> Sie k√∂nnen den JSON-Code kopieren oder als Datei herunterladen.
                    </p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button 
                    @click="copyExportJSON()"
                    :class="exportCopied ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'"
                    class="px-4 py-2 text-white rounded-lg transition-colors flex items-center gap-2"
                >
                    <svg x-show="!exportCopied" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <svg x-show="exportCopied" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span x-text="exportCopied ? 'Kopiert!' : 'Kopieren'"></span>
                </button>
                <button 
                    @click="downloadExportJSON()"
                    class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    Herunterladen
                </button>
                <button 
                    @click="closeExportModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Schlie√üen
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Toolbar f√ºr Text-Selektion -->
    <div 
        x-show="showFloatingToolbar"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 scale-95"
        x-transition:enter-end="opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-95"
        class="floating-toolbar fixed z-50 bg-white rounded-lg shadow-lg border border-gray-200 p-2 flex flex-col gap-2 min-w-[300px] max-w-[500px]"
        :style="'top: ' + floatingToolbarPosition.top + 'px; left: ' + floatingToolbarPosition.left + 'px; transform: translateX(-50%);'"
        @click.stop
        style="display: none;"
    >
        <!-- Buttons Row -->
        <div class="flex gap-1 items-center flex-wrap">
            <button 
                @click.stop="applyTextFormat('bold')"
                class="px-3 py-1.5 bg-white rounded hover:bg-gray-100 text-sm font-bold border border-gray-200"
                title="Fett"
            >
                <strong>B</strong>
            </button>
            <button 
                @click.stop="applyTextFormat('italic')"
                class="px-3 py-1.5 bg-white rounded hover:bg-gray-100 text-sm italic border border-gray-200"
                title="Kursiv"
            >
                <em>I</em>
            </button>
            <button 
                @click.stop="applyTextFormat('underline')"
                class="px-3 py-1.5 bg-white rounded hover:bg-gray-100 text-sm underline border border-gray-200"
                title="Unterstrichen"
            >
                <u>U</u>
            </button>
            <div class="w-px bg-gray-300 mx-1 h-6"></div>
            <button 
                @click.stop="openLinkInputForSelection()"
                class="px-3 py-1.5 bg-white rounded hover:bg-gray-100 text-sm border border-gray-200 flex items-center gap-1"
                title="Link hinzuf√ºgen/bearbeiten"
            >
                üîó Link
            </button>
            <div class="w-px bg-gray-300 mx-1 h-6"></div>
            <button 
                @click.stop="removeFormatting()"
                class="px-3 py-1.5 bg-white rounded hover:bg-gray-100 text-sm border border-gray-200"
                title="Formatierung entfernen"
            >
                üóë Formatierung entfernen
            </button>
        </div>
        
        <!-- Selected Text Row -->
        <div class="w-full pt-2 border-t border-gray-200">
            <div class="text-xs text-gray-500 px-2 py-1.5 bg-gray-50 rounded break-words" x-text="selectedText"></div>
        </div>
    </div>

    <!-- Link Input Modal f√ºr Text-Selektion -->
    <div 
        x-show="showLinkInputModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeLinkInputModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full flex flex-col"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-xl font-bold text-gray-900" x-text="editingLink ? 'üîó Link bearbeiten' : 'üîó Link hinzuf√ºgen'"></h2>
                <button 
                    @click="closeLinkInputModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Text:
                        </label>
                        <div class="p-3 bg-gray-50 rounded-lg text-sm text-gray-700 border border-gray-200" x-text="selectedText || editingLink?.text || ''"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            URL:
                        </label>
                        <input 
                            type="text"
                            x-model="linkInputUrl"
                            @keydown.enter.prevent="applyLinkToSelection()"
                            @click.stop
                            @focus.stop
                            placeholder="https://example.com"
                            class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                        <p class="mt-1 text-xs text-gray-500">
                            Beispiel: <code class="bg-gray-100 px-1 rounded">https://example.com</code>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-between items-center gap-3 p-6 border-t border-gray-200">
                <button 
                    x-show="editingLink"
                    @click="removeLink()"
                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                >
                    Link entfernen
                </button>
                <div class="flex gap-3 ml-auto">
                    <button 
                        @click="closeLinkInputModal()"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                    >
                        Abbrechen
                    </button>
                    <button 
                        @click="applyLinkToSelection()"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        x-text="editingLink ? 'Link aktualisieren' : 'Link hinzuf√ºgen'"
                    ></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Link Settings Modal -->
    <div 
        x-show="showLinkSettingsModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        @click.self="closeLinkSettingsModal()"
        style="display: none;"
    >
        <div 
            class="bg-white rounded-lg shadow-xl max-w-md w-full flex flex-col"
            @click.stop
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-900">üîó Link-Einstellungen</h2>
                <button 
                    @click="closeLinkSettingsModal()"
                    class="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                    title="Schlie√üen"
                >
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Link-Text:
                        </label>
                        <input 
                            type="text"
                            x-model="linkSettingsText"
                            @click.stop
                            @focus.stop
                            placeholder="Link-Text eingeben..."
                            class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Link-URL:
                        </label>
                        <input 
                            type="text"
                            x-model="linkSettingsUrl"
                            @click.stop
                            @focus.stop
                            placeholder="https://example.com"
                            class="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                        <p class="mt-1 text-xs text-gray-500">
                            Beispiel: <code class="bg-gray-100 px-1 rounded">https://example.com</code>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                <button 
                    @click="closeLinkSettingsModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    Abbrechen
                </button>
                <button 
                    @click="saveLinkSettings()"
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                    Speichern
                </button>
            </div>
        </div>
    </div>

</body>
</html>

